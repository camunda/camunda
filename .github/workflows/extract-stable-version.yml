# description: Extracts the stable version from the branch name
# type: CI
# owner: @camunda/monorepo-devops-team
name: Extract Stable Version from Branch Name

permissions:
  contents: read

on:
  workflow_call:
    outputs:
      version_tag:
        description: "Generated Docker version tag"
        value: ${{ steps.split_branch.outputs.result }}

env:
  GHA_BEST_PRACTICES_LINTER: enabled

jobs:
  extract-stable-version:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions: { }
    if: github.repository == 'camunda/camunda' && (github.ref == 'refs/heads/main' || startsWith(github.ref, 'refs/heads/stable/'))
    outputs:
      result: ${{ steps.split_branch.outputs.result }}
    steps:
      - name: Get stable version from branch name, return nothing if not stable
        id: split_branch
        run: |
          branch="${{ inputs.branch_name }}"
          if [[ "$branch" == stable/* ]]; then
            suffix="${branch#stable/}"
            echo "result=$suffix" >> $GITHUB_OUTPUT
          else
            echo "result=" >> $GITHUB_OUTPUT
          fi
