# description: Runs Integration tests on different versions and vendors of RDBMS databases
# test location: /qa/acceptance-tests
# type: CI
# owner: @camunda/core-features, @camunda/data-layer
name: Rdbms Manual/Scheduled Run Integration Tests

on:
  workflow_dispatch:
  pull_request:
    paths:
      - ".github/workflows/zeebe-rdbms-integration-tests.yml"
  schedule:
    - cron: "0 5 * * Mon-Fri"

env:
  GHA_BEST_PRACTICES_LINTER: enabled

defaults:
  run:
    # use bash shell by default to ensure pipefail behavior is the default
    # see https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#exit-codes-and-error-action-preference
    shell: bash

jobs:
  rdbms-integration-tests:
    name: "RDBMS ${{ matrix.database-name }}"
    permissions:
      actions: write
      contents: read
    strategy:
      fail-fast: false
      matrix:
        include:
          # PostgreSQL - Supported versions: 14, 15, 16, 17, 18
          - database-name: "Postgres 14"
            database-type: "postgres"
            database-image-version: "14-alpine"
            it-database-type: "rdbms_postgres"
          - database-name: "Postgres 15"
            database-type: "postgres"
            database-image-version: "15-alpine"
            it-database-type: "rdbms_postgres"
          - database-name: "Postgres 16"
            database-type: "postgres"
            database-image-version: "16-alpine"
            it-database-type: "rdbms_postgres"
          - database-name: "Postgres 17"
            database-type: "postgres"
            database-image-version: "17-alpine"
            it-database-type: "rdbms_postgres"
          - database-name: "Postgres 18"
            database-type: "postgres"
            database-image-version: "18-alpine"
            it-database-type: "rdbms_postgres"
          # MySQL - Supported version: 8.4
          - database-name: "MySQL 8.4"
            database-type: "mysql"
            database-image-version: "8.4"
            it-database-type: "rdbms_mysql"
          # MariaDB - Supported versions: 10.11, 11.4, 11.8
          - database-name: "MariaDB 11.4"
            database-type: "mariadb"
            database-image-version: "11.4"
            it-database-type: "rdbms_mariadb"
          - database-name: "MariaDB 11.8"
            database-type: "mariadb"
            database-image-version: "11.8"
            it-database-type: "rdbms_mariadb"
          # Microsoft SQL Server - Supported versions: 2019, 2022, 2025
          - database-name: "MSSQL 2019"
            database-type: "mssql"
            database-image-version: "2019-latest"
            it-database-type: "rdbms_mssql"
          - database-name: "MSSQL 2022"
            database-type: "mssql"
            database-image-version: "2022-latest"
            it-database-type: "rdbms_mssql"
          - database-name: "MSSQL 2025"
            database-type: "mssql"
            database-image-version: "2025-latest"
            it-database-type: "rdbms_mssql"
          # Oracle - Supported version: 23ai (19c not available as Docker image)
          - database-name: "Oracle 23ai"
            database-type: "oracle"
            database-image-version: "23-slim-faststart"
            it-database-type: "rdbms_oracle"
    uses: ./.github/workflows/ci-database-integration-tests-reusable.yml
    secrets: inherit
    with:
      database-type: ${{ matrix.database-type }}
      database-image-version: ${{ matrix.database-image-version }}
      it-database-type: ${{ matrix.it-database-type }}
      notify-slack-on-failure: ${{ github.event_name == 'schedule' }}
