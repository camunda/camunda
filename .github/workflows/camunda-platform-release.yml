name: Camunda Platform Release Workflow
on:
  workflow_call:
    inputs:
      releaseBranch:
        description: 'The branch to perform the release on, defaults to `release-$releaseVersion`'
        type: string
        required: false
        default: ''

defaults:
  run:
    shell: bash

env:
  GIT_TRACE: 1
  RELEASE_BRANCH: ${{ inputs.releaseBranch != '' && inputs.releaseBranch || format('release-{0}', inputs.releaseVersion) }}
  RELEASE_VERSION: ${{ inputs.releaseVersion }}
  GH_TOKEN: ${{ github.token }} # needs to be available for the gh CLI tool
  GITHUB_TOKEN_USR: ${{ github.token }} # needs to be available for the SCM URL in pom.xml
jobs:
  release:
    name: Maven Release
    runs-on: macos-latest
    steps:
# Attempt 1
      - uses: actions/checkout@v4
        with:
          ref: ${{ env.RELEASE_BRANCH }}
          fetch-depth: 0
          fetch-tags: true
      - name: Push Git changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git version
          git config --list
          git fsck --strict
          git gc
          git tag 8.6.11-test-SNAPSHOT-1
          git push -v --progress origin tag 8.6.11-test-SNAPSHOT-1
