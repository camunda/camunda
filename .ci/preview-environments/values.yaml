---
# Default values for Tasklist Preview Environments

# The values file follows helm best practices https://helm.sh/docs/chart_best_practices/values/
# This means:
#   * Variable names should begin with a lowercase letter, and words should be separated with camelcase.
#   * Every defined property in values.yaml should be documented. The documentation string should begin with the name of the property that it describes, and then give at least a one-sentence description


ingress:
  # Defines the domain under which to expose the ingress
  domain: tasklist.camunda.cloud


git:
  # Defines the branch name to use for annotating resources
  branch: main
  # Defines the repository URL to use for annotating resources
  repoUrl: https://github.com/camunda/tasklist


# Configuration of the camunda-platform chart, in particular we disable some features that
# we don't want to deploy.
# We also change the `fullNameOverride` and `zeebeClusterName`
# to simpler values, so we don't duplicate the ReleaseName everwhere
# (as that's already reflected in the Namespace and can be quite long).
camunda-platform:
  # identity needs to be disabled explicitly
  identity:
    enabled: false
  optimize:
    enabled: false
  tasklist:
    fullnameOverride: tasklist
    image:
      repository: registry.camunda.cloud/team-operate/tasklist
    env:
    - name: JAVA_OPTS
      value: "-XX:MaxRAMFraction=1"
    - name: SPRING_PROFILES_ACTIVE
      value: "dev-data"
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 0.5
        memory: 512Mi
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  operate:
    # Defines the version of Operate to use
    image:
      tag: SNAPSHOT
    fullnameOverride: operate
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 0.5
        memory: 512Mi
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  zeebe:
    fullnameOverride: zeebe
    # Defines the version of Zeebe to use
    image:
      tag: 8.2.0
    # ClusterSize defines the amount of brokers (=replicas), which are deployed via helm
    clusterSize: "1"
    # PartitionCount defines how many zeebe partitions are set up in the cluster
    partitionCount: "1"
    # ReplicationFactor defines how each partition is replicated, the value defines the number of nodes
    replicationFactor: "1"
    # Enable the creation of persistent volumes.
    persistenceType: disk
    # Defines a reasonable default for the `zeebe` StatefulSet, for when persistence is enabled.
    pvcSize: 1Gi
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 500m
        memory: 512Mi
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  zeebe-gateway:
    fullnameOverride: zeebe-gateway
    replicas: 1
    # Defines the version of Zeebe to use
    image:
      tag: 8.2.0
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

  # Configuration for ElasticSearch. Persistence is disabled by default,
  # and we're setting some reasonable defaults for the `PersistentVolumeClaim` size
  # in order to avoid being too wasteful.
  # Feel free to enable persistence and adjust storage on a per-branch level whenever needed.
  elasticsearch:
    replicas: 1
    imageTag: 7.16.2
    persistence:
      enabled: true
    volumeClaimTemplate:
      resources:
        requests:
          storage: 1Gi
    # This is needed to disable the creation of poddisruptionbudget resource coming from ES chart (supported in k8s 1.21)
    maxUnavailable: ""
    minimumMasterNodes: 1
    extraEnvs:
    - name: xpack.security.enabled
      value: "false"
    - name: processors
      value: "1"
    clusterHealthCheckParams: wait_for_status=yellow&timeout=1s
    esJavaOpts: "-Xms512m -Xmx512m"
    securityContext:
      capabilities:
        add:
          - IPC_LOCK
    resources:
      limits:
        cpu: 1
        memory: 1Gi
      requests:
        cpu: 0.5
        memory: 512Mi
    initResources:
      limits:
        cpu: "25m"
        memory: "128Mi"
      requests:
        cpu: "25m"
        memory: "128Mi"
    nodeSelector:
      cloud.google.com/gke-nodepool: previews
    tolerations:
      - key: "previews"
        operator: "Exists"
        effect: "NoSchedule"

# Configuration of global values as required by the camunda-platform chart and to comply
# with Infra best practices.
global:
  image:
    pullSecrets:
      - name: registry-camunda-cloud
  zeebeClusterName: zeebe
  # identity should be explicitly disabled in global as well
  identity:
    # Identity.auth configuration, to configure Identity authentication setup
    auth:
      # Identity.auth.enabled if true, enables the Identity authentication otherwise basic-auth will be used on all services.
      enabled: false
  labels:
    camunda.cloud/source: argocd
    camunda.cloud/managed-by: Helm
    app: preview-tasklist-camunda-cloud # Should be overridden by Argo app
