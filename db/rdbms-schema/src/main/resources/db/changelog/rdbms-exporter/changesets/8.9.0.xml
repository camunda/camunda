<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under
  ~ one or more contributor license agreements. See the NOTICE file distributed
  ~ with this work for additional information regarding copyright ownership.
  ~ Licensed under the Camunda License 1.0. You may not use this file
  ~ except in compliance with the Camunda License 1.0.
  -->
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
  <property name="timestampWithTimeZone.type" value="DATETIMEOFFSET" dbms="mssql"/>

  <changeSet id="create_exporter_position_table" author="camunda">
    <createTable tableName="${prefix}EXPORTER_POSITION">
      <column name="PARTITION_ID" type="NUMBER">
        <constraints primaryKey="true"/>
      </column>
      <column name="EXPORTER" type="VARCHAR(200)"/>
      <column name="LAST_EXPORTED_POSITION" type="BIGINT"/>
      <column name="CREATED" type="DATETIME"/>
      <column name="LAST_UPDATED" type="DATETIME"/>
    </createTable>
  </changeSet>

  <changeSet id="create_process_deployment_table" author="camunda">
    <createTable tableName="${prefix}PROCESS_DEFINITION">
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="RESOURCE_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="BPMN_XML" type="CLOB"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="VERSION" type="SMALLINT"/>
      <column name="VERSION_TAG" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FORM_ID" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}PROCESS_DEFINITION" indexName="${prefix}IDX_PROCESS_DEFINITION_ID">
      <column name="PROCESS_DEFINITION_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_process_instance_table" author="camunda">
    <createTable tableName="${prefix}PROCESS_INSTANCE">
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="STATE" type="VARCHAR(20)"/>
      <column name="START_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARENT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PARENT_ELEMENT_INSTANCE_KEY" type="BIGINT"/>
      <column name="NUM_INCIDENTS" type="SMALLINT"/>
      <column name="VERSION" type="SMALLINT"/>
      <column name="PARTITION_ID" type="NUMBER"/>
      <column name="TREE_PATH" type="VARCHAR(4000)"/>
      <column name="HISTORY_CLEANUP_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
    </createTable>

    <createIndex tableName="${prefix}PROCESS_INSTANCE" indexName="${prefix}IDX_PROCESS_INSTANCE_HIST">
      <column name="PARTITION_ID" />
      <column name="HISTORY_CLEANUP_DATE" />
    </createIndex>

    <createIndex tableName="${prefix}PROCESS_INSTANCE"
      indexName="${prefix}IDX_PROCESS_INSTANCE_PD_KEY">
      <column name="PROCESS_DEFINITION_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}PROCESS_INSTANCE" indexName="${prefix}IDX_ROOT_PROCESS_INSTANCE_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>

  </changeSet>

  <changeSet id="create_process_instance_tag_table" author="camunda">
    <createTable tableName="${prefix}PROCESS_INSTANCE_TAG">
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT">
        <constraints primaryKey="true" foreignKeyName="${prefix}FK_PROCESS_INSTANCE_TAG_PROCESS_INSTANCE" referencedTableName="${prefix}PROCESS_INSTANCE" referencedColumnNames="PROCESS_INSTANCE_KEY" deleteCascade="true"/>
        />
      </column>
      <column name="TAG_VALUE" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
    </createTable>
    <createIndex tableName="${prefix}PROCESS_INSTANCE_TAG" indexName="${prefix}IDX_PROCESS_INSTANCE_TAG_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_variable_table" author="camunda">
    <createTable tableName="${prefix}VARIABLE">
      <column name="VAR_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="SCOPE_KEY" type="BIGINT"/>
      <column name="TYPE" type="VARCHAR(255)"/>
      <column name="VAR_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DOUBLE_VALUE" type="DOUBLE"/>
      <column name="LONG_VALUE" type="BIGINT"/>
      <column name="VAR_VALUE" type="VARCHAR(8192)"/>
      <column name="VAR_FULL_VALUE" type="CLOB"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="IS_PREVIEW" type="BOOLEAN"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}VARIABLE" indexName="${prefix}IDX_VARIABLE_PROCESS_INSTANCE_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>
    <createIndex tableName="${prefix}VARIABLE" indexName="${prefix}IDX_VARIABLE_ROOT_PROCESS_INSTANCE_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>
    <createIndex tableName="${prefix}VARIABLE" indexName="${prefix}IDX_VARIABLE_TENANT_ID">
      <column name="TENANT_ID"/>
    </createIndex>

    <modifySql dbms="oracle">
      <!-- Oracle only supports a size 4000 characters in varchar2 -->
      <replace replace="VARCHAR2(8192)" with="VARCHAR2(4000)"/>
    </modifySql>
  </changeSet>


  <changeSet id="create_flow_node_table" author="camunda">
    <createTable tableName="${prefix}FLOW_NODE_INSTANCE">
      <column name="FLOW_NODE_INSTANCE_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FLOW_NODE_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FLOW_NODE_SCOPE_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="TYPE" type="VARCHAR(100)"/>
      <column name="STATE" type="VARCHAR(20)"/>
      <column name="START_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="TREE_PATH" type="VARCHAR(4000)"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="INCIDENT_KEY" type="BIGINT"/>
      <column name="NUM_SUBPROCESS_INCIDENTS" type="SMALLINT"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}FLOW_NODE_INSTANCE" indexName="${prefix}IDX_FLOW_NODE_INSTANCE_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}FLOW_NODE_INSTANCE" indexName="${prefix}IDX_FLOW_NODE_INSTANCE_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet author="camunda" id="create_usertask_table">
    <createTable tableName="${prefix}USER_TASK">
      <column name="USER_TASK_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="ELEMENT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="CREATION_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="COMPLETION_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="ASSIGNEE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="STATE" type="VARCHAR(20)"/>
      <column name="FORM_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ELEMENT_INSTANCE_KEY" type="BIGINT"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DUE_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="FOLLOW_UP_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="EXTERNAL_FORM_REFERENCE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_VERSION" type="SMALLINT"/>
      <column name="CUSTOM_HEADERS" type="CLOB"/>
      <column name="PRIORITY" type="INT"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}USER_TASK" indexName="${prefix}IDX_USER_TASK_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}USER_TASK" indexName="${prefix}IDX_USER_TASK_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}USER_TASK" indexName="${prefix}IDX_USER_TASK_FNI_KEY">
      <column name="ELEMENT_INSTANCE_KEY"/>
    </createIndex>

    <createTable tableName="${prefix}CANDIDATE_USER">
      <column name="USER_TASK_KEY" type="BIGINT">
        <constraints foreignKeyName="${prefix}FK_CANDIDATE_USER_USER_TASK" referencedTableName="${prefix}USER_TASK" referencedColumnNames="USER_TASK_KEY" deleteCascade="true"/>
        />
      </column>
      <column name="CANDIDATE_USER" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createTable tableName="${prefix}CANDIDATE_GROUP">
      <column name="USER_TASK_KEY" type="BIGINT">
        <constraints foreignKeyName="${prefix}FK_CANDIDATE_GROUP_USER_TASK" referencedTableName="${prefix}USER_TASK" referencedColumnNames="USER_TASK_KEY" deleteCascade="true"/>
        />
      </column>
      <column name="CANDIDATE_GROUP" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createTable tableName="${prefix}USER_TASK_TAG">
      <column name="USER_TASK_KEY" type="BIGINT">
        <constraints primaryKey="true" foreignKeyName="${prefix}FK_USER_TASK_TAG_USER_TASK" referencedTableName="${prefix}USER_TASK" referencedColumnNames="USER_TASK_KEY" deleteCascade="true"/>
        />
      </column>
      <column name="TAG_VALUE" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
    </createTable>

    <createIndex tableName="${prefix}CANDIDATE_USER" indexName="${prefix}IDX_CANDIDATE_USER_USER_TASK_KEY">
      <column name="USER_TASK_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}CANDIDATE_GROUP" indexName="${prefix}IDX_CANDIDATE_GROUP_USER_TASK_KEY">
      <column name="USER_TASK_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}USER_TASK_TAG" indexName="${prefix}IDX_USER_TASK_TAG_USER_TASK_KEY">
      <column name="USER_TASK_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_incident" author="camunda">
    <createTable tableName="${prefix}INCIDENT">
      <column name="INCIDENT_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="FLOW_NODE_INSTANCE_KEY" type="BIGINT"/>
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="ERROR_MESSAGE" type="VARCHAR(4000)"/>
      <column name="ERROR_MESSAGE_HASH" type="INT"/>
      <column name="ERROR_TYPE" type="VARCHAR(100)"/>
      <column name="STATE" type="VARCHAR(20)"/>
      <column name="CREATION_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="TREE_PATH" type="VARCHAR(4000)"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="JOB_KEY" type="BIGINT"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}INCIDENT" indexName="${prefix}IDX_INCIDENT_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}INCIDENT" indexName="${prefix}IDX_INCIDENT_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_decision_definition_table" author="camunda">
    <createTable tableName="${prefix}DECISION_DEFINITION">
      <column name="DECISION_DEFINITION_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="DECISION_DEFINITION_ID" type="VARCHAR(255)"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="VERSION" type="SMALLINT"/>
      <column name="DECISION_REQUIREMENTS_KEY" type="BIGINT"/>
      <column name="DECISION_REQUIREMENTS_ID" type="VARCHAR(255)"/>
      <column name="DECISION_REQUIREMENTS_NAME" type="VARCHAR(255)"/>
      <column name="DECISION_REQUIREMENTS_VERSION" type="SMALLINT"/>
    </createTable>

    <createIndex tableName="${prefix}DECISION_DEFINITION" indexName="${prefix}IDX_DECISION_DEFINITION_ID">
      <column name="DECISION_DEFINITION_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_decision_requirements_table" author="camunda">
    <createTable tableName="${prefix}DECISION_REQUIREMENTS">
      <column name="DECISION_REQUIREMENTS_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="DECISION_REQUIREMENTS_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="VERSION" type="SMALLINT"/>
      <column name="RESOURCE_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="XML" type="CLOB"/>
    </createTable>

    <createIndex tableName="${prefix}DECISION_REQUIREMENTS" indexName="${prefix}IDX_DECISION_REQUIREMENTS_ID">
      <column name="DECISION_REQUIREMENTS_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_decision_instance_table" author="camunda">
    <createTable tableName="${prefix}DECISION_INSTANCE">
      <column name="DECISION_INSTANCE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="DECISION_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="DECISION_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DECISION_DEFINITION_KEY" type="BIGINT"/>
      <column name="DECISION_REQUIREMENTS_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DECISION_REQUIREMENTS_KEY" type="BIGINT"/>
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FLOW_NODE_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_DECISION_DEFINITION_KEY" type="BIGINT"/>
      <column name="EVALUATION_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="TYPE" type="VARCHAR(255)"/>
      <column name="STATE" type="VARCHAR(255)"/>
      <column name="RESULT" type="VARCHAR(${userCharColumnSize})"/>
      <column name="EVALUATION_FAILURE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="EVALUATION_FAILURE_MESSAGE" type="VARCHAR(4000)"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARTITION_ID" type="NUMBER"/>
      <column name="HISTORY_CLEANUP_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
    </createTable>

    <createIndex tableName="${prefix}DECISION_INSTANCE"
      indexName="${prefix}IDX_DECISION_INSTANCE_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}DECISION_INSTANCE"
      indexName="${prefix}IDX_DECISION_INSTANCE_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}DECISION_INSTANCE"
      indexName="${prefix}IDX_DECISION_INSTANCE_KEY">
      <column name="DECISION_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}DECISION_INSTANCE"
      indexName="${prefix}IDX_DECISION_INSTANCE_DD_KEY">
      <column name="DECISION_DEFINITION_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}DECISION_INSTANCE"
      indexName="${prefix}IDX_DECISION_INSTANCE_FNI_KEY">
      <column name="FLOW_NODE_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}DECISION_INSTANCE" indexName="${prefix}IDX_DECISION_INSTANCE_HIST">
      <column name="PARTITION_ID" />
      <column name="HISTORY_CLEANUP_DATE" />
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_decision_instance_input_table" author="camunda">
    <createTable tableName="${prefix}DECISION_INSTANCE_INPUT">
      <column name="DECISION_INSTANCE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints foreignKeyName="${prefix}FK_DEC_INST_INPUT_DEC_INST" referencedTableName="${prefix}DECISION_INSTANCE" referencedColumnNames="DECISION_INSTANCE_ID" deleteCascade="true"/>
        />
      </column>
      <column name="INPUT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="INPUT_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="INPUT_VALUE" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}DECISION_INSTANCE_INPUT" indexName="${prefix}IDX_DECISION_INSTANCE_INPUT_INSTANCE_ID">
      <column name="DECISION_INSTANCE_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_decision_instance_output_table" author="camunda">
    <createTable tableName="${prefix}DECISION_INSTANCE_OUTPUT">
      <column name="DECISION_INSTANCE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints foreignKeyName="${prefix}FK_DEC_INST_OUTPUT_DEC_INST" referencedTableName="${prefix}DECISION_INSTANCE" referencedColumnNames="DECISION_INSTANCE_ID" deleteCascade="true"/>
        />
      </column>
      <column name="OUTPUT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="RULE_INDEX" type="SMALLINT"/>
      <column name="OUTPUT_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="OUTPUT_VALUE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="RULE_ID" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}DECISION_INSTANCE_OUTPUT" indexName="${prefix}IDX_DECISION_INSTANCE_OUTPUT_INSTANCE_ID">
      <column name="DECISION_INSTANCE_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_user_table" author="camunda">
    <createTable tableName="${prefix}USER_">
      <column name="USERNAME" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="USER_KEY" type="BIGINT"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="EMAIL" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PASSWORD" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}USER_"
      indexName="${prefix}IDX_USER_USER_KEY">
      <column name="USER_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_form_table" author="camunda">
    <createTable tableName="${prefix}FORM">
      <column name="FORM_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="FORM_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="SCHEMA_XML" type="CLOB"/>
      <column name="VERSION" type="BIGINT"/>
      <column name="IS_DELETED" type="BOOLEAN"/>
    </createTable>

    <createIndex tableName="${prefix}FORM" indexName="${prefix}IDX_FORM_ID">
      <column name="FORM_ID"/>
    </createIndex>
    <createIndex tableName="${prefix}FORM" indexName="${prefix}IDX_FORM_TENANT_ID">
      <column name="TENANT_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_tenant_table" author="camunda">
    <createTable tableName="${prefix}TENANT">
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="TENANT_KEY" type="BIGINT"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DESCRIPTION" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}TENANT"
      indexName="${prefix}IDX_TENANT_TENANT_KEY">
      <column name="TENANT_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="tenant_members_table" author="camunda">
    <createTable tableName="${prefix}TENANT_MEMBER">
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_TYPE" type="VARCHAR(255)"/>
    </createTable>

    <createIndex tableName="${prefix}TENANT_MEMBER"
      indexName="${prefix}idx_tenant_member_tenant_id">
      <column name="TENANT_ID"/>
    </createIndex>

    <createIndex tableName="${prefix}TENANT_MEMBER"
      indexName="${prefix}idx_tenant_member_entity_id">
      <column name="ENTITY_ID"/>
    </createIndex>
  </changeSet>


  <changeSet id="create_role_table" author="camunda">
    <createTable tableName="${prefix}ROLES">
      <column name="ROLE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="ROLE_KEY" type="BIGINT"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DESCRIPTION" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}ROLES"
      indexName="${prefix}IDX_ROLE_ROLE_KEY">
      <column name="ROLE_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="role_members_table" author="camunda">
    <createTable tableName="${prefix}ROLE_MEMBER">
      <column name="ROLE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_TYPE" type="VARCHAR(255)"/>
    </createTable>

    <createIndex tableName="${prefix}ROLE_MEMBER" indexName="${prefix}idx_role_member_role_id">
      <column name="ROLE_ID"/>
    </createIndex>

    <createIndex tableName="${prefix}ROLE_MEMBER" indexName="${prefix}idx_role_member_entity_id">
      <column name="ENTITY_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_group_table" author="camunda">
    <createTable tableName="${prefix}GROUP_">
      <column name="GROUP_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="GROUP_KEY" type="BIGINT"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DESCRIPTION" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}GROUP_"
      indexName="${prefix}IDX_GROUP_GROUP_KEY">
      <column name="GROUP_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="group_members_table" author="camunda">
    <createTable tableName="${prefix}GROUP_MEMBER">
      <column name="GROUP_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_TYPE" type="VARCHAR(255)"/>
    </createTable>

    <createIndex tableName="${prefix}GROUP_MEMBER" indexName="${prefix}idx_group_member_group_id">
      <column name="GROUP_ID"/>
    </createIndex>

    <createIndex tableName="${prefix}GROUP_MEMBER" indexName="${prefix}idx_group_member_entity_id">
      <column name="ENTITY_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_authorization_permission_table" author="camunda">
    <!-- no PK possible, would have too many columns (ALL) -->
    <createTable tableName="${prefix}AUTHORIZATIONS">
      <column name="AUTHORIZATION_KEY" type="BIGINT"/>
      <column name="OWNER_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="OWNER_TYPE" type="VARCHAR(255)"/>
      <column name="RESOURCE_TYPE" type="VARCHAR(255)"/>
      <column name="RESOURCE_MATCHER" type="SMALLINT"/>
      <column name="RESOURCE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="RESOURCE_PROPERTY_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PERMISSION_TYPE" type="VARCHAR(255)"/>
    </createTable>

    <createIndex tableName="${prefix}AUTHORIZATIONS" indexName="${prefix}IDX_AUTHORIZATIONS_AUTHORIZATION_KEY">
      <column name="AUTHORIZATION_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}AUTHORIZATIONS" indexName="${prefix}IDX_AUTHORIZATIONS_OWNER_ID">
      <column name="OWNER_ID"/>
    </createIndex>

    <createIndex tableName="${prefix}AUTHORIZATIONS" indexName="${prefix}IDX_AUTHORIZATIONS_OWNER_TYPE">
      <column name="OWNER_TYPE"/>
    </createIndex>

    <createIndex tableName="${prefix}AUTHORIZATIONS" indexName="${prefix}IDX_AUTHORIZATIONS_RESOURCE_TYPE">
      <column name="RESOURCE_TYPE"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_batch_operation_table" author="camunda">
    <createTable tableName="${prefix}BATCH_OPERATION">
      <column name="BATCH_OPERATION_KEY" type="VARCHAR(255)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="STATE" type="VARCHAR(255)"/>
      <column name="OPERATION_TYPE" type="VARCHAR(255)"/>
      <column name="START_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="OPERATIONS_TOTAL_COUNT" type="INT"/>
      <column name="OPERATIONS_FAILED_COUNT" type="INT"/>
      <column name="OPERATIONS_COMPLETED_COUNT" type="INT"/>
      <column name="HISTORY_CLEANUP_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
    </createTable>

    <createTable tableName="${prefix}BATCH_OPERATION_ITEM">
      <column name="BATCH_OPERATION_KEY" type="VARCHAR(255)">
        <constraints primaryKey="true" nullable="false" foreignKeyName="${prefix}FK_BATCH_OPERATION_ITEM_BATCH_OPERATION" referencedTableName="${prefix}BATCH_OPERATION" referencedColumnNames="BATCH_OPERATION_KEY" deleteCascade="true"/>
      </column>
      <column name="ITEM_KEY" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESSED_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="ERROR_MESSAGE" type="VARCHAR(4000)"/>
      <column name="STATE" type="VARCHAR(20)" defaultValue="ACTIVE"/>
    </createTable>

    <createTable tableName="${prefix}BATCH_OPERATION_ERROR">
      <column name="BATCH_OPERATION_KEY" type="VARCHAR(255)">
        <constraints foreignKeyName="${prefix}FK_BATCH_OPERATION_ERROR_BATCH_OPERATION" referencedTableName="${prefix}BATCH_OPERATION" referencedColumnNames="BATCH_OPERATION_KEY" deleteCascade="true"/>
        />
      </column>
      <column name="PARTITION_ID" type="NUMBER"/>
      <column name="TYPE" type="VARCHAR(255)"/>
      <column name="MESSAGE" type="VARCHAR(4000)"/>
    </createTable>

    <createIndex tableName="${prefix}BATCH_OPERATION_ERROR" indexName="${prefix}IDX_BATCH_OPERATION_ERROR_KEY">
      <column name="BATCH_OPERATION_KEY"/>
      <column name="PARTITION_ID"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_job_table" author="camunda">
    <createTable tableName="${prefix}JOB">
      <column name="JOB_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ELEMENT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ELEMENT_INSTANCE_KEY" type="BIGINT"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TYPE" type="VARCHAR(255)"/>
      <column name="WORKER" type="VARCHAR(${userCharColumnSize})"/>
      <column name="STATE" type="VARCHAR(20)"/>
      <column name="KIND" type="VARCHAR(50)"/>
      <column name="LISTENER_EVENT_TYPE" type="VARCHAR(50)"/>
      <column name="ERROR_MESSAGE" type="VARCHAR(4000)"/>
      <column name="ERROR_CODE" type="VARCHAR(255)"/>
      <column name="DEADLINE" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="CUSTOM_HEADERS" type="CLOB"/>
      <column name="RETRIES" type="SMALLINT"/>
      <column name="HAS_FAILED_WITH_RETRIES_LEFT" type="BOOLEAN"/>
      <column name="IS_DENIED" type="BOOLEAN"/>
      <column name="DENIED_REASON" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}JOB" indexName="${prefix}IDX_JOB_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}JOB" indexName="${prefix}IDX_JOB_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}JOB" indexName="${prefix}IDX_JOB_FNI_KEY">
      <column name="ELEMENT_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_sequence_flow_table" author="camunda">
    <createTable tableName="${prefix}SEQUENCE_FLOW">
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}SEQUENCE_FLOW" indexName="${prefix}IDX_SEQUENCE_FLOW_PROCESS_INSTANCE_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}SEQUENCE_FLOW" indexName="${prefix}IDX_SEQUENCE_FLOW_ROOT_PROCESS_INSTANCE_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_usage_metric_tables" author="camunda">
    <createTable tableName="${prefix}USAGE_METRIC">
      <column name="USAGE_METRIC_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="START_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="EVENT_TYPE" type="INTEGER"/>
      <column name="EVENT_VALUE" type="BIGINT"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}USAGE_METRIC" indexName="${prefix}IDX_USAGE_METRIC_END_TIME">
      <column name="END_TIME"/>
    </createIndex>

    <createTable tableName="${prefix}USAGE_METRIC_TU">
      <column name="USAGE_METRIC_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="START_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="ASSIGNEE_HASH" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}USAGE_METRIC_TU"
      indexName="${prefix}IDX_USAGE_METRIC_TU_END_TIME">
      <column name="END_TIME"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_mapping_rule_table" author="camunda">
    <createTable tableName="${prefix}MAPPING_RULES">
      <column name="MAPPING_RULE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="MAPPING_RULE_KEY" type="BIGINT"/>
      <column name="CLAIM_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="CLAIM_VALUE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="NAME" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}MAPPING_RULES"
      indexName="${prefix}IDX_MAPPING_RULES_MAPPING_RULE_KEY">
      <column name="MAPPING_RULE_KEY"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_message_subscription_table" author="camunda">
    <createTable tableName="${prefix}MESSAGE_SUBSCRIPTION">
      <column name="MESSAGE_SUBSCRIPTION_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FLOW_NODE_INSTANCE_KEY" type="BIGINT"/>
      <column name="MESSAGE_SUBSCRIPTION_STATE" type="VARCHAR(20)"/>
      <column name="DATE_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="MESSAGE_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="CORRELATION_KEY" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARTITION_ID" type="NUMBER"/>
    </createTable>

    <createIndex tableName="${prefix}MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_MESSAGE_SUBSCRIPTION_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_MESSAGE_SUBSCRIPTION_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_MESSAGE_SUBSCRIPTION_FNI_KEY">
      <column name="FLOW_NODE_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_correlated_message_subscription_table" author="camunda">
    <createTable tableName="${prefix}CORRELATED_MESSAGE_SUBSCRIPTION">
      <column name="CORRELATION_KEY" type="VARCHAR(${userCharColumnSize})"/>
      <column name="CORRELATION_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="FLOW_NODE_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FLOW_NODE_INSTANCE_KEY" type="BIGINT"/>
      <column name="MESSAGE_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="MESSAGE_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PARTITION_ID" type="NUMBER"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="SUBSCRIPTION_KEY" type="BIGINT">
        <constraints primaryKey="true"/>
      </column>
      <column name="SUBSCRIPTION_TYPE" type="VARCHAR(255)"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <createIndex tableName="${prefix}CORRELATED_MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_CORRELATED_MESSAGE_SUBSCRIPTION_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}CORRELATED_MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_CORRELATED_MESSAGE_SUBSCRIPTION_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}CORRELATED_MESSAGE_SUBSCRIPTION" indexName="${prefix}IDX_CORRELATED_MESSAGE_SUBSCRIPTION_FNI_KEY">
      <column name="FLOW_NODE_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_cluster_variable_table" author="camunda">
    <createTable tableName="${prefix}CLUSTER_VARIABLE">
      <column name="CLUSTER_VARIABLE_ID" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true"/>
      </column>
      <column name="VAR_NAME" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TYPE" type="VARCHAR(255)"/>
      <column name="DOUBLE_VALUE" type="DOUBLE"/>
      <column name="LONG_VALUE" type="BIGINT"/>
      <column name="VAR_VALUE" type="VARCHAR(8192)"/>
      <column name="VAR_FULL_VALUE" type="CLOB"/>
      <column name="IS_PREVIEW" type="BOOLEAN"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="SCOPE" type="VARCHAR(255)"/>
    </createTable>

    <createIndex tableName="${prefix}CLUSTER_VARIABLE"
      indexName="${prefix}IDX_CLUSTER_VARIABLE_TENANT_ID">
      <column name="TENANT_ID"/>
    </createIndex>

    <createIndex tableName="${prefix}CLUSTER_VARIABLE"
      indexName="${prefix}IDX_CLUSTER_VARIABLE_SCOPE">
      <column name="SCOPE"/>
    </createIndex>

    <modifySql dbms="oracle">
      <!-- Oracle only supports a size 4000 characters in varchar2 -->
      <replace replace="VARCHAR2(8192)" with="VARCHAR2(4000)"/>
    </modifySql>
  </changeSet>

  <changeSet id="add_job_creation_and_last_update_time_columns" author="camunda">
    <addColumn tableName="${prefix}JOB">
      <column name="CREATION_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="LAST_UPDATE_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
    </addColumn>

    <modifySql dbms="mariadb,mysql">
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_audit_log_table" author="camunda">
    <createTable tableName="${prefix}AUDIT_LOG">
      <column name="AUDIT_LOG_KEY" type="VARCHAR(${userCharColumnSize})">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="ENTITY_KEY" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_TYPE" type="VARCHAR(50)"/>
      <column name="OPERATION_TYPE" type="VARCHAR(50)"/>
      <column name="ENTITY_VERSION" type="INT"/>
      <column name="ENTITY_VALUE_TYPE" type="SMALLINT"/>
      <column name="ENTITY_OPERATION_INTENT" type="SMALLINT"/>
      <column name="BATCH_OPERATION_KEY" type="BIGINT"/>
      <column name="BATCH_OPERATION_TYPE" type="VARCHAR(50)"/>
      <column name="TIMESTAMP" type="TIMESTAMP WITH TIME ZONE(3)">
        <constraints nullable="false"/>
      </column>
      <column name="ACTOR_TYPE" type="VARCHAR(50)"/>
      <column name="ACTOR_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="TENANT_SCOPE" type="VARCHAR(50)"/>
      <column name="RESULT" type="VARCHAR(50)"/>
      <column name="ANNOTATION" type="VARCHAR(4000)"/>
      <column name="CATEGORY" type="VARCHAR(50)"/>
      <column name="PROCESS_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DECISION_REQUIREMENTS_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="DECISION_DEFINITION_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="PROCESS_DEFINITION_KEY" type="BIGINT"/>
      <column name="PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ROOT_PROCESS_INSTANCE_KEY" type="BIGINT"/>
      <column name="ELEMENT_INSTANCE_KEY" type="BIGINT"/>
      <column name="JOB_KEY" type="BIGINT"/>
      <column name="USER_TASK_KEY" type="BIGINT"/>
      <column name="DECISION_REQUIREMENTS_KEY" type="BIGINT"/>
      <column name="DECISION_DEFINITION_KEY" type="BIGINT"/>
      <column name="DECISION_EVALUATION_KEY" type="BIGINT"/>
      <column name="DEPLOYMENT_KEY" type="BIGINT"/>
      <column name="FORM_KEY" type="BIGINT"/>
      <column name="RESOURCE_KEY" type="BIGINT"/>
      <column name="RELATED_ENTITY_TYPE" type="VARCHAR(50)"/>
      <column name="RELATED_ENTITY_KEY" type="VARCHAR(${userCharColumnSize})"/>
      <column name="ENTITY_DESCRIPTION" type="VARCHAR(255)"/>
      <column name="PARTITION_ID" type="NUMBER"/>
      <column name="HISTORY_CLEANUP_DATE" type="TIMESTAMP WITH TIME ZONE(3)"/>
    </createTable>

    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_HIST">
      <column name="PARTITION_ID" />
      <column name="HISTORY_CLEANUP_DATE" />
    </createIndex>

    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_PI_KEY">
      <column name="PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_RPI_KEY">
      <column name="ROOT_PROCESS_INSTANCE_KEY"/>
    </createIndex>

    <modifySql dbms="mariadb,mysql">
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_history_deletion_table" author="camunda">
    <createTable tableName="${prefix}HISTORY_DELETION">
      <column name="RESOURCE_KEY" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="BATCH_OPERATION_KEY" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="RESOURCE_TYPE" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="PARTITION_ID" type="NUMBER">
        <constraints nullable="false"/>
      </column>
    </createTable>

  </changeSet>

  <changeSet id="add_actor_columns_to_batch_operations" author="camunda">
    <addColumn tableName="${prefix}BATCH_OPERATION">
      <column name="ACTOR_TYPE" type="VARCHAR(50)"/>
      <column name="ACTOR_ID" type="VARCHAR(${userCharColumnSize})"/>
    </addColumn>
  </changeSet>

  <changeSet id="create_web_session_table" author="camunda">
    <createTable tableName="${prefix}WEB_SESSION">
      <column name="SESSION_ID" type="VARCHAR(255)">
        <constraints primaryKey="true"/>
      </column>
      <column name="CREATION_TIME" type="BIGINT"/>
      <column name="LAST_ACCESSED_TIME" type="BIGINT"/>
      <column name="MAX_INACTIVE_INTERVAL_IN_SECONDS" type="BIGINT"/>
      <column name="ATTRIBUTES" type="BLOB"/>
    </createTable>
    <modifySql dbms="h2">
      <replace replace="BLOB" with="BINARY LARGE OBJECT"/>
    </modifySql>
    <modifySql dbms="postgresql">
      <replace replace="OID" with="BYTEA"/>
    </modifySql>
  </changeSet>

  <changeSet id="create_audit_log_authorization_indexes" author="camunda">
    <!-- Index for filtering by CATEGORY (used in authorization checks for AUDIT_LOG resource type
         and USER_TASKS filtering) -->
    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_CATEGORY">
      <column name="CATEGORY"/>
    </createIndex>

    <!-- Index for filtering by PROCESS_DEFINITION_ID (used in authorization checks for
         process instance and user task access, including IS NOT NULL checks) -->
    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_PROC_DEF_ID">
      <column name="PROCESS_DEFINITION_ID"/>
    </createIndex>

    <!-- Composite index for efficient filtering of USER_TASKS by specific process definition IDs
         (covers the compound condition: CATEGORY = 'USER_TASKS' AND PROCESS_DEFINITION_ID IN (...)) -->
    <createIndex tableName="${prefix}AUDIT_LOG" indexName="${prefix}IDX_AUDIT_LOG_CAT_PROC_DEF_ID">
      <column name="CATEGORY"/>
      <column name="PROCESS_DEFINITION_ID"/>
    </createIndex>
  </changeSet>

  <changeSet id="create_job_metrics_batch_table" author="camunda">
    <createTable tableName="${prefix}JOB_METRICS_BATCH">
      <column name="JOB_METRICS_BATCH_KEY" type="VARCHAR(255)">
        <constraints primaryKey="true"/>
      </column>
      <column name="START_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="END_TIME" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="INCOMPLETE_BATCH" type="BOOLEAN"/>
      <column name="TENANT_ID" type="VARCHAR(${userCharColumnSize})"/>
      <column name="FAILED_COUNT" type="INT"/>
      <column name="LAST_FAILED_AT" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="COMPLETED_COUNT" type="INT"/>
      <column name="LAST_COMPLETED_AT" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="CREATED_COUNT" type="INT"/>
      <column name="LAST_CREATED_AT" type="TIMESTAMP WITH TIME ZONE(3)"/>
      <column name="JOB_TYPE" type="VARCHAR(${userCharColumnSize})"/>
      <column name="WORKER" type="VARCHAR(${userCharColumnSize})"/>
    </createTable>

    <modifySql dbms="mariadb,mysql">
      <!-- MariaDB doesn't support TIMESTAMP WITH TIME ZONE, but its TIMESTAMP type has already a time zone -->
      <replace replace="TIMESTAMP WITH TIME ZONE" with="TIMESTAMP"/>
    </modifySql>
    <modifySql dbms="mssql">
      <replace replace="datetime2" with="DATETIMEOFFSET"/>
    </modifySql>
  </changeSet>

</databaseChangeLog>
