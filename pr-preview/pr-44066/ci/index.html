<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ci" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">CI &amp; Automation | Camunda Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://camunda.github.io/camunda/pr-preview/pr-44066/ci/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CI &amp; Automation | Camunda Platform"><meta data-rh="true" name="description" content="This page has information and answers questions around how the C8 monorepo CI and related tools like Renovate work. It should serve as a knowledge base including FAQ for Camunda and external contributors."><meta data-rh="true" property="og:description" content="This page has information and answers questions around how the C8 monorepo CI and related tools like Renovate work. It should serve as a knowledge base including FAQ for Camunda and external contributors."><link data-rh="true" rel="icon" href="/camunda/pr-preview/pr-44066/img/black-C.png"><link data-rh="true" rel="canonical" href="https://camunda.github.io/camunda/pr-preview/pr-44066/ci/"><link data-rh="true" rel="alternate" href="https://camunda.github.io/camunda/pr-preview/pr-44066/ci/" hreflang="en"><link data-rh="true" rel="alternate" href="https://camunda.github.io/camunda/pr-preview/pr-44066/ci/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"CI & Automation","item":"https://camunda.github.io/camunda/pr-preview/pr-44066/ci"}]}</script><link rel="stylesheet" href="/camunda/pr-preview/pr-44066/assets/css/styles.9181a4df.css">
<script src="/camunda/pr-preview/pr-44066/assets/js/runtime~main.d1abc3d6.js" defer="defer"></script>
<script src="/camunda/pr-preview/pr-44066/assets/js/main.986d7ea9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/camunda/pr-preview/pr-44066/img/black-C.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/camunda/pr-preview/pr-44066/"><div class="navbar__logo"><img src="/camunda/pr-preview/pr-44066/img/black-C.png" alt="Camunda Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/camunda/pr-preview/pr-44066/img/black-C.png" alt="Camunda Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Camunda Platform</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/camunda/camunda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/camunda/pr-preview/pr-44066/"><span title="Camunda Platform Documentation" class="linkLabel_WmDU">Camunda Platform Documentation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/camunda/pr-preview/pr-44066/ci/"><span title="CI &amp; Automation" class="linkLabel_WmDU">CI &amp; Automation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/camunda/pr-preview/pr-44066/release/"><span title="Release Process" class="linkLabel_WmDU">Release Process</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/camunda/pr-preview/pr-44066/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">CI &amp; Automation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>CI &amp; Automation</h1></header>
<p>This page has information and answers questions around how the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> and related tools like <a href="#renovate" class="">Renovate</a> work. It should serve as a knowledge base including FAQ for Camunda and external contributors.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="git-branches">Git Branches<a href="#git-branches" class="hash-link" aria-label="Direct link to Git Branches" title="Direct link to Git Branches" translate="no">​</a></h2>
<ul>
<li class=""><code>main</code>: permanent branch for feature development of next C8 minor version (GitHub default branch)</li>
<li class=""><code>stable/*</code>: long-lived branches for maintenance of past C8 minor versions (deleted on support end)</li>
<li class=""><code>release*</code>: short-lived branches for release activities (helps to achieve code freeze) created from <code>main</code> or <code>stable/*</code></li>
<li class=""><em>any other branch</em>: (short-lived) branches for feature development to be merged using Pull Requests, via <a href="#github-merge-queue" class="">merge queues</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="available-snapshot-artifacts">Available SNAPSHOT Artifacts<a href="#available-snapshot-artifacts" class="hash-link" aria-label="Direct link to Available SNAPSHOT Artifacts" title="Direct link to Available SNAPSHOT Artifacts" translate="no">​</a></h3>
<p>Maven artifacts are available on <a href="https://artifacts.camunda.com/" target="_blank" rel="noopener noreferrer" class="">Artifactory</a> and Docker images are available on <a href="https://hub.docker.com/u/camunda/" target="_blank" rel="noopener noreferrer" class="">DockerHub</a>:</p>
<ul>
<li class="">Pushed commits to <code>main</code> branch produce:<!-- -->
<ul>
<li class="">Maven artifacts with version <code>8.9.0-SNAPSHOT</code> for all C8 components</li>
<li class="">Docker images with tag <code>SNAPSHOT</code> for <a href="https://hub.docker.com/r/camunda/operate/tags?name=SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Operate</a>, <a href="https://hub.docker.com/r/camunda/tasklist/tags?name=SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Tasklist</a>, <a href="https://hub.docker.com/r/camunda/zeebe/tags?name=SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Zeebe</a></li>
<li class="">Docker images with tag <code>8-SNAPSHOT</code> for <a href="https://hub.docker.com/r/camunda/optimize/tags?name=8-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Optimize</a></li>
</ul>
</li>
<li class="">Pushed commits to <code>stable/8.8</code> branch produce:<!-- -->
<ul>
<li class="">Maven artifacts with version <code>8.8.0-SNAPSHOT</code> for Operate, Tasklist, Zeebe</li>
<li class="">Docker images with tag <code>8.8-SNAPSHOT</code> for <a href="https://hub.docker.com/r/camunda/optimize/tags?name=8.8-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Optimize</a>, <a href="https://hub.docker.com/r/camunda/operate/tags?name=8.8-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Operate</a>, <a href="https://hub.docker.com/r/camunda/tasklist/tags?name=8.8-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Tasklist</a>, <a href="https://hub.docker.com/r/camunda/zeebe/tags?name=8.8-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Zeebe</a></li>
</ul>
</li>
<li class="">Pushed commits to <code>stable/8.7</code> branch produce:<!-- -->
<ul>
<li class="">Maven artifacts with version <code>8.7.0-SNAPSHOT</code> for Operate, Tasklist, Zeebe</li>
<li class="">Docker images with tag <code>8.7-SNAPSHOT</code> for <a href="https://hub.docker.com/r/camunda/operate/tags?name=8.7-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Operate</a>, <a href="https://hub.docker.com/r/camunda/tasklist/tags?name=8.7-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Tasklist</a>, <a href="https://hub.docker.com/r/camunda/zeebe/tags?name=8.7-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Zeebe</a></li>
</ul>
</li>
<li class="">Pushed commits to <code>stable/optimize-8.7</code> branch produce:<!-- -->
<ul>
<li class="">Maven artifacts with version <code>8.7.0-SNAPSHOT</code> for <strong>Optimize</strong></li>
<li class="">Docker images with tag <code>8.7-SNAPSHOT</code> for <strong><a href="https://hub.docker.com/r/camunda/optimize/tags?name=8.7-SNAPSHOT" target="_blank" rel="noopener noreferrer" class="">Optimize</a></strong></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-tracking">Issue Tracking<a href="#issue-tracking" class="hash-link" aria-label="Direct link to Issue Tracking" title="Direct link to Issue Tracking" translate="no">​</a></h2>
<p>All problems, bugs and feature requests regarding the CI of the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> are tracked using <a href="https://github.com/camunda/camunda/issues" target="_blank" rel="noopener noreferrer" class="">GitHub Issues</a>.</p>
<p>For visibility and prioritization there is the <a href="https://github.com/orgs/camunda/projects/115" target="_blank" rel="noopener noreferrer" class="">Monorepo CI project board</a> that tracks high-level issues.</p>
<p>New reports of issues need to be checked against the <a href="https://github.com/camunda/camunda/issues" target="_blank" rel="noopener noreferrer" class="">GitHub Issues</a> to avoid duplication: new occurrences of existing issues need to reported in comments, otherwise raise a new issue labelled <code>area/build</code> or reach out via Slack to the Monorepo CI DRI.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://github.com/orgs/camunda/projects/115" target="_blank" rel="noopener noreferrer" class="">Monorepo CI project board (internal)</a></li>
<li class=""><a href="https://github.com/camunda/camunda/issues?q=is%3Aissue+label%3Aarea%2Fbuild" target="_blank" rel="noopener noreferrer" class="">Issues labelled area/build</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prioritization">Prioritization<a href="#prioritization" class="hash-link" aria-label="Direct link to Prioritization" title="Direct link to Prioritization" translate="no">​</a></h3>
<p>Prioritization of issues is done by the Monorepo CI DRI according to severity which follows from these criteria:</p>
<ol>
<li class="">Impacted functionality:<!-- -->
<ul>
<li class=""><strong>Highest severity</strong> for issues related to workflows that are:<!-- -->
<ul>
<li class="">marked as <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">GitHub required status checks</a></li>
<li class="">part of the <a href="#github-merge-queue" class="">GitHub merge queue</a> to <code>main</code></li>
<li class="">run on <code>main</code> branch</li>
<li class="">part of release process</li>
</ul>
</li>
<li class="">Lower severity for any other workflows</li>
</ul>
</li>
<li class="">Amount of users impacted:<!-- -->
<ul>
<li class="">Generally severity scales with the amount of affected people that interact with the monorepo (Camundi/external contributors)</li>
<li class="">Can be assessed with <a href="#ci-health-metrics" class="">CI health</a> or on anecdotal level</li>
</ul>
</li>
<li class="">Available workarounds:<!-- -->
<ul>
<li class="">Severity is lower if a workaround is available, especially if that workaround is easy to use/low effort</li>
</ul>
</li>
</ol>
<p>Dealing with reported issues that are identified as urgent/<strong>high severity</strong>:</p>
<ul>
<li class="">Communicate the degraded functionality/impact and that there is an ongoing investigation to affected people.</li>
<li class="">Debug problems on GitHub Actions level yourself, involve the stakeholder teams (via their medic) or subject matter experts for advice on technical details.</li>
<li class="">Try to identify a (limited) workaround to unblock users.</li>
<li class="">Communicate any workarounds and resolution of the problem.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ" translate="no">​</a></h3>
<p><strong>Q: What do I do when I see the CI failing with a seemingly unrelated error?</strong></p>
<blockquote>
<p>A: Search the open <a href="https://github.com/camunda/camunda/issues" target="_blank" rel="noopener noreferrer" class="">GitHub Issues</a> with the failure message to see if the problem is known: If you find an issue for the same problem, leave a comment with the new occurrance. Otherwise raise a new issue labelled <code>area/build</code> to start tracking that CI failure or reach out via Slack to the Monorepo CI DRI.</p>
</blockquote>
<p><strong>Q: How to deal with flaky tests that block CI?</strong></p>
<blockquote>
<p>A: Disable the flaky test(s) and comment on existing ticket or create a new one that the flaky test needs to be re-enabled <em>after</em> fixing it. No single test can be more important that the stability of the remaining CI system impacting dozens of developers.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="github-merge-queue">GitHub Merge Queue<a href="#github-merge-queue" class="hash-link" aria-label="Direct link to GitHub Merge Queue" title="Direct link to GitHub Merge Queue" translate="no">​</a></h2>
<p><a href="https://github.blog/2023-07-12-github-merge-queue-is-generally-available/" target="_blank" rel="noopener noreferrer" class="">GitHub Merge Queue</a> helps automate the Pull Request (PR) merging process by creating a temporary branch for each batch of PRs, running checks against the latest target branch, and merging changes only if the checks pass, ensuring a more streamlined and error-free workflow.</p>
<p>Merge queues exist per branch (one for <code>main</code>, one for <code>stable/8.7</code>, etc.) in the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> and are configured independently via <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/about-rulesets" target="_blank" rel="noopener noreferrer" class="">rulesets</a>. So different branches can have different <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> to control which CI workflows must be green to allow merging.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-a-merge-queue" target="_blank" rel="noopener noreferrer" class="">GitHub documentation on merge queues</a></li>
<li class=""><a href="https://github.com/camunda/camunda/queue/main" target="_blank" rel="noopener noreferrer" class="">Merge queue of <code>main</code> branch (PRs and time estimates)</a></li>
<li class=""><a href="https://github.com/camunda/camunda/rules?ref=refs%2Fheads%2Fmain" target="_blank" rel="noopener noreferrer" class="">Ruleset for <code>main</code> branch</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="faq-1">FAQ<a href="#faq-1" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ" translate="no">​</a></h3>
<p><strong>Q: Why do we use merge queues instead of manually merging PRs?</strong></p>
<blockquote>
<p>A: In repositories like the C8 monorepo with a high number of contributing engineers and high development velocity dozens of Pull Requests can get created and merged each day. Avoiding downtimes like waiting for a window to merge PRs <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-a-merge-queue" target="_blank" rel="noopener noreferrer" class="">boosts productivity</a> and allows us to scale.</p>
</blockquote>
<p><strong>Q: Why do we have <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> for PRs and merge queues?</strong></p>
<blockquote>
<p>A: Automated software tests increase our confidence into delivering a working software product. Required status checks are a way to technically ensure that engineers get early feedback about potential problems. This way we only merge Pull Requests to <code>main</code> branch that will not fail those automated tests impacting quality or other engineers. This also helps with automerging dependency updates using <a href="#renovate" class="">Renovate</a>.</p>
</blockquote>
<p><strong>Q: What are the current <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> for PRs and merge queue to <code>main</code>?</strong></p>
<blockquote>
<p>A: You can find the up2date list <a href="https://github.com/camunda/camunda/rules?ref=refs%2Fheads%2Fmain" target="_blank" rel="noopener noreferrer" class="">here</a>:</p>
<ul>
<li class=""><code>check-results</code> check from <a href="https://github.com/camunda/camunda/blob/df3a8296085cb7bbc1065d86e43f2b77bd02b017/.github/workflows/ci.yml#L158" target="_blank" rel="noopener noreferrer" class="">ci.yml</a> (<a href="#unified-ci" class="">Unified CI</a>)</li>
</ul>
</blockquote>
<p><strong>Q: Do those <a href="https://github.com/camunda/camunda/rules?ref=refs%2Fheads%2Fmain" target="_blank" rel="noopener noreferrer" class="">required status checks</a> of <code>main</code> guarantee that all commits are green?</strong></p>
<blockquote>
<p>A: Yes, for the scope of the <a href="#unified-ci" class="">Unified CI</a> except for an admin bypass of the merge queue in case of incidents.</p>
</blockquote>
<p><strong>Q: My PR had only green checks when I queued it, why was it removed from the merge queue?</strong></p>
<blockquote>
<p>A: The merge queue creates a temporary branch from the latest target branch (e.g. <code>main</code>) with your PR merged and then runs CI again. Your changes could be incompatible with the target branch or CI failed e.g. due to flakiness. Look up the check results for details on the CI failure.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="unified-ci">Unified CI<a href="#unified-ci" class="hash-link" aria-label="Direct link to Unified CI" title="Direct link to Unified CI" translate="no">​</a></h2>
<p>&quot;Unified CI&quot; is the name of an approach to establish <em>one</em> central CI pipeline that runs checks for <em>code changes</em> of the whole monorepo instead of multiple unrelated, side-by-side pipelines for each component in the monorepo.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals" translate="no">​</a></h3>
<p>This central pipeline will use change detection to run checks only when needed thus improving runtime and lowering cost. After migrating, the central CI pipeline will be the only GitHub <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status check</a> for PRs and merge queue to <code>main</code> thus improving UX and preventing edge cases with multiple checks and path filters.</p>
<p>This central pipeline will run on all Pull Requests, the <a href="#github-merge-queue" class="">merge queue</a> to <code>main</code> and on <code>push</code> for <code>main</code> (and in the future other stable branches). Out of scope are scheduled and release workflows.</p>
<p>This topic is work-in-progress as part of <a href="https://github.com/camunda/camunda/issues/17721" target="_blank" rel="noopener noreferrer" class="">#17721</a> to migrate remaining workflows once they meet certain criteria (short runtimes under 10 minutes and low flakiness) to the central CI.</p>
<p>A full run of the central CI pipeline should take ideally around 15 minutes with individual jobs only taking 10 minutes of runtime at most.</p>
<p>GitHub Actions pipeline code should should be de-duplicated for the same task and moved out from <a href="https://github.com/camunda/camunda/blob/main/.github/workflows/ci.yml" target="_blank" rel="noopener noreferrer" class="">ci.yml</a> into other reusable workflows named <code>ci-&lt;subtask&gt;.yml</code> or composite actions to keep the <code>ci.yml</code> short and lean.</p>
<p><strong>Non-goal:</strong> Workflows that don&#x27;t trigger on code changes will not be part of the Unified CI, like scheduled workflows.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-inclusion-criteria">Workflow Inclusion Criteria<a href="#workflow-inclusion-criteria" class="hash-link" aria-label="Direct link to Workflow Inclusion Criteria" title="Direct link to Workflow Inclusion Criteria" translate="no">​</a></h3>
<p>Workflows that seek inclusion to the Unified CI (and thus GitHub required status checks) need to fulfill the following criteria and best practices:</p>
<ul>
<li class="">runtime of at most 10 minutes<!-- -->
<ul>
<li class="">set <code>timeout-minutes: 10</code> on the job level</li>
<li class="">parallelize lengthy tasks and/or use bigger runners for compute intensive tasks</li>
</ul>
</li>
<li class="">instrumented to emit <a href="#ci-health-metrics" class="">CI health metrics</a></li>
<li class="">high stability (low flakiness)<!-- -->
<ul>
<li class="">no CI failures for 10 consecutive builds, see <a href="#how-to-verify-that-a-ci-check-is-robust-and-stable-not-flaky" class="">here how to check it</a></li>
<li class="">handle flaky tests gracefully, options:<!-- -->
<ol>
<li class="">retry them 3-5 times while staying in the timeout and report them via <a href="https://github.com/camunda/camunda/pull/26715" target="_blank" rel="noopener noreferrer" class="">detailed test statistics API</a> to <a href="#ci-health-metrics" class="">CI health</a></li>
<li class="">disable them and create a ticket to fix them long-term</li>
</ol>
</li>
</ul>
</li>
<li class="">use <a href="#ci-secret-management" class="">Vault for secret management</a></li>
<li class="">follow the <a href="#caching-strategy" class="">GitHub Actions Cache strategy</a> for the monorepo</li>
<li class="">follow all <a href="#ci-security" class="">CI Security best practices</a> for the monorepo</li>
<li class="">follow the <a href="#flaky-tests" class="">best practices to handle flaky tests</a></li>
</ul>
<p>If the required short runtime <em>cannot</em> be achieved, consider moving long-running tests into nightly jobs or standalone workflows that are no <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> and don&#x27;t run in the merge queue (to preserve merge velocity).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation" translate="no">​</a></h3>
<p>This section explains how to achieve including a CI check into the Unified CI as a required status check so that it is executed only when relevant files changed in a PR.</p>
<p>To include a workflow <a href="#workflow-inclusion-criteria" class="">fitting the criteria</a> into the Unified CI <strong>all</strong> of the following steps have to be taken for each job of that workflow:</p>
<ol>
<li class=""><strong>Change Detection:</strong> Define path filter for all file changes that should trigger the new job in this <a href="https://github.com/camunda/camunda/blob/main/.github/actions/paths-filter/action.yml" target="_blank" rel="noopener noreferrer" class="">composite action</a>. This information is relevant for the next step, make sure to:<!-- -->
<ul>
<li class="">Add a new <code>output</code> to the <a href="https://github.com/camunda/camunda/blob/main/.github/actions/paths-filter/action.yml" target="_blank" rel="noopener noreferrer" class="">composite action</a> representing the condition when the new job should be triggered.</li>
<li class="">The output have the same name as the new job it triggers.</li>
<li class="">The output condition should reuse existing filters and combine them as needed.</li>
<li class="">If no matching existing filter, add a new one in a step.</li>
<li class="">Adjust the <a href="https://github.com/camunda/camunda/blob/b46d8ba974152d7b2cf1f1f5dac9585657fda7cb/.github/workflows/ci.yml#L25" target="_blank" rel="noopener noreferrer" class=""><code>detect-changes</code> job</a> to re-expose the new <code>output</code> under the same name.</li>
</ul>
</li>
<li class=""><strong>CI Check:</strong> Relies on the previous step to run the new job only if relevant files changed. Add the new job defintion to the <a href="https://github.com/camunda/camunda/blob/main/.github/workflows/ci.yml" target="_blank" rel="noopener noreferrer" class="">ci.yml</a> file, by:<!-- -->
<ul>
<li class="">
<p>Following this pattern:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">descriptive-job-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># reuse information from change detection on whether to run this job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> needs.detect</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">changes.outputs.descriptive</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name == &#x27;true&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">needs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">detect</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">changes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest  </span><span class="token comment" style="color:#999988;font-style:italic"># or other</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">timeout-minutes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># or less</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># unless GITHUB_TOKEN is needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...ACTUAL CI CHECK STEPS HERE...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Observe build status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">continue-on-error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.github/actions/observe</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">build_status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> job.status </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secret_vault_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ADDR </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secret_vault_roleId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ROLE_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secret_vault_secretId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_SECRET_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>It is important to depend on the <code>detect-changes</code> job and use the newly defined output as a condition.</p>
</li>
<li class="">
<p>If the new job has many steps, you need to refactor them into a reusable workflow or composite action to keep <code>ci.yml</code> lean.</p>
</li>
<li class="">
<p>Adding <a href="#ci-health-metrics" class="">observability for CI health</a> is required.</p>
</li>
</ul>
</li>
<li class=""><strong>Results Check:</strong> Include the new job as <code>needs</code> dependency in <a href="https://github.com/camunda/camunda/blob/b46d8ba974152d7b2cf1f1f5dac9585657fda7cb/.github/workflows/ci.yml#L166" target="_blank" rel="noopener noreferrer" class=""><code>check-results</code></a> job (required status check). This is needed so that the Unified CI is marked as failure if one of its jobs fails.</li>
</ol>
<p>Related resources:</p>
<ul>
<li class="">entrypoint and main file for pipeline code of unified CI: <a href="https://github.com/camunda/camunda/blob/main/.github/workflows/ci.yml" target="_blank" rel="noopener noreferrer" class="">ci.yml</a></li>
<li class="">see for example how <a href="https://github.com/camunda/camunda/pull/19423" target="_blank" rel="noopener noreferrer" class="">#19423 (actionlint)</a> and <a href="https://github.com/camunda/camunda/pull/19436" target="_blank" rel="noopener noreferrer" class="">#19436 (Java unit tests)</a> got added to unified CI</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ci-test-files">CI Test Files<a href="#ci-test-files" class="hash-link" aria-label="Direct link to CI Test Files" title="Direct link to CI Test Files" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ownership">Ownership<a href="#ownership" class="hash-link" aria-label="Direct link to Ownership" title="Direct link to Ownership" translate="no">​</a></h3>
<p>Each CI test file has an owning team. The owning team can be found either through the <code>CODEOWNERS</code> file or on the metadata in the file itself. The <code>CODEOWNERS</code> file is organized and broken down by team, any additions to the file should follow that convention. The metadata on a GHA workflow file is used by a scraping tool so that it is easy to gather information about the current state of CI. You can look at the metadata for a quick overview of the owning team, where the tests live, how the test is called, and a description of what the file is actually testing</p>
<p>Metadata follows this structure and is placed at the beginning of a GHA workflow file</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;Description of what the GHA is running and what is being tested&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># test location: &lt;The filepath of the tests being run&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># owner: &lt;The name of the owning team&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="legacy-ci">Legacy CI<a href="#legacy-ci" class="hash-link" aria-label="Direct link to Legacy CI" title="Direct link to Legacy CI" translate="no">​</a></h3>
<p>&quot;Legacy CI&quot; is a name for CI tests that has not been migrated to the Unified CI. Legacy tests do not meet the <a href="#workflow-inclusion-criteria" class="">inclusion criteria for Unified CI</a>, such as running under 10 minutes.</p>
<p>Tests that are marked as Legacy are to be migrated to Unified CI by the owning team in the future. Once migrated, the test should live inside the <code>ci.yml</code> file, or be part of a workflow file that is called by it. The label of &quot;Legacy&quot; should be removed as well</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="consolidated-unit-tests">Consolidated Unit Tests<a href="#consolidated-unit-tests" class="hash-link" aria-label="Direct link to Consolidated Unit Tests" title="Direct link to Consolidated Unit Tests" translate="no">​</a></h3>
<p>The Consolidated Unit Test job in the Unified CI runs unit tests by team and component. (For example, Operate tests owned by the Data Layer team). These tests are run by JUnit5 Suites. Each suite selects which tests to run by package. This enables the CI job to run a sub-set of all tests in a module, so that the tests being run are relevant to the owning team. Any new package for tests should be added to the relevant suite.</p>
<p>Suite names must follow a naming convention of <code>{componentName}{team}TestSuite</code>. The composite of the component and and the team is used by the CI job to select which component and team to run the tests for. For example, <code>OperateCoreFeaturesTestSuite</code> is used to run Core Features tests on Operate</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="naming-conventions">Naming Conventions<a href="#naming-conventions" class="hash-link" aria-label="Direct link to Naming Conventions" title="Direct link to Naming Conventions" translate="no">​</a></h3>
<p>Names for CI tests are composed by Github Actions, which is a combination of CI job names. The composed name is shown on PRs and when viewing an individual test run in the Github UI. The composed name should follow the below naming convention to ensure consistency, clarity across the CI system, make it easy to identify the owning team, and which component is being tested.</p>
<p>For Names of tests in the Unified CI, the name should be structured as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CI / &lt;componentName&gt; / [&lt;testType&gt;] &lt;testName&gt; / &lt;ownerName&gt; / ...</span><br></span></code></pre></div></div>
<p><code>testType</code> can be things like: <code>UT</code> for Unit Tests, <code>IT</code> for Integration Tests, <code>Smoke</code> for smoke tests, etc.</p>
<p>For example, Core Features Unit Tests for Tasklist would be appear as</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CI / Tasklist / [UT] Core Features / Run Unit Tests</span><br></span></code></pre></div></div>
<p>Importer Integration Tests for Operate would appear as</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CI / Operate / [IT] Importer Tests / Data Layer / run-test</span><br></span></code></pre></div></div>
<p>For Names for Legacy tests should be prefixed with <code>[Legacy] &lt;componentName&gt;</code> so that Legacy tests are organized and appear together when run on a PR. The rest of the name should be descriptive of what the test is doing.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="renovate">Renovate<a href="#renovate" class="hash-link" aria-label="Direct link to Renovate" title="Direct link to Renovate" translate="no">​</a></h2>
<p><a href="https://docs.renovatebot.com/" target="_blank" rel="noopener noreferrer" class="">Renovate</a> is a bot and GitHub app that automates dependency updates in software projects by scanning the source code for outdated libraries and applications, then creating Pull Requests to upgrade them to the latest versions, which helps keeping the project secure and up-to-date.</p>
<p>Renovate supports many package ecosystems of which we use e.g. Maven, NPM, Docker and Helm. It can scan multiple branches (e.g. <code>main</code>, <code>stable/8.5</code>) inside of one repository and raise PRs independently for those.</p>
<p>Renovate is configured via a <a href="https://github.com/camunda/camunda/blob/main/.github/renovate.json" target="_blank" rel="noopener noreferrer" class="">JSON configuration file on the <code>main</code> branch</a>. In general we allow Renovate to run and <strong>create PRs at any time</strong> to avoid lagging behind with updates.</p>
<p>We also want Renovate to <strong>automatically merge</strong> dependency updates when CI is green and automated tests are passing. Assuming a nearly complete test coverage the efficiency gains outweigh the risks. This is achieved by Renovate requesting to put every Pull Requests into the <a href="#github-merge-queue" class="">GitHub Merge Queue</a> - GitHub will then ensure that <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> pass before merging the PR.</p>
<p>We additionally use the <a href="https://github.com/apps/renovate-approve" target="_blank" rel="noopener noreferrer" class="">renovate-approve bot</a> to circumvent the PR reviewer requirements.</p>
<p>Pull Request labels that have a special meaning for Renovate:</p>
<ul>
<li class=""><code>dependencies</code>: added by our Renovate configuration to designate dependency PRs</li>
<li class=""><code>automerge</code>: added by our Renovate configuration to designate dependency PRs that should get automatically merged</li>
<li class=""><code>area/security</code>: added by our Renovate configuration to designate dependency PRs that fix a security vulnerability</li>
<li class=""><code>stop-updating</code>: can be added by humans to tell Renovate to not rebase an open PR anymore (if the change is breaking anyways)</li>
</ul>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://docs.renovatebot.com/" target="_blank" rel="noopener noreferrer" class="">Renovate documentation</a></li>
<li class=""><a href="https://github.com/camunda/camunda/issues/12605" target="_blank" rel="noopener noreferrer" class="">Dependency Dashboard (GH issue)</a></li>
<li class=""><a href="https://developer.mend.io/github/camunda/camunda" target="_blank" rel="noopener noreferrer" class="">Renovate Dashboard</a></li>
<li class=""><a href="https://github.com/camunda/camunda/blob/main/.github/renovate.json" target="_blank" rel="noopener noreferrer" class="">Renovate configuration file on <code>main</code> branch</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="faq-2">FAQ<a href="#faq-2" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ" translate="no">​</a></h3>
<p><strong>Q: Why do we use Renovate instead of manually looking for dependency updates?</strong></p>
<blockquote>
<p>A: We automate repetitive and error-prone tasks as much as possible to save valuable Engineering time for solving problems requiring more creativity, e.g. complex major version upgrades of dependencies.</p>
</blockquote>
<p><strong>Q: Why do we use Renovate instead of Dependabot etc.?</strong></p>
<blockquote>
<p>A: Renovate is more flexible, supports more package ecosystems, has a detailed configuration and already used successfully in other places in Camunda so we can reuse existing experience.</p>
</blockquote>
<p><strong>Q: Why does Renovate attempt to merge a PR with failing status checks?</strong></p>
<blockquote>
<p>A: Renovate will always try to automerge dependency update PRs since it does not know about CI failures. It is GitHub&#x27;s task to enforce <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging" target="_blank" rel="noopener noreferrer" class="">required status checks</a> and reject the merge attempt - as long as no PR with failing status check gets actually merged, everything is working as intended.</p>
</blockquote>
<p><strong>Q: Why does Renovate not detect dependency XYZ?</strong></p>
<blockquote>
<p>A: Renovate parses and analyzes most well known dependency management files (e.g. <code>pom.xml</code>) automatically. Not detecting a dependency can be due to an unrecognized file format, a typo in the name, a bug in Renovate or the dependency being missing from the package ecosystem. This will usually be reported in the Renovate logs.</p>
</blockquote>
<p><strong>Q: How to access the Renovate logs?</strong></p>
<blockquote>
<p>A: Click on the most recent run in the <a href="https://developer.mend.io/github/camunda/camunda" target="_blank" rel="noopener noreferrer" class="">Renovate Dashboard</a> and make sure to show debug information.</p>
</blockquote>
<p><strong>Q: Why are updates for dependency XYZ ignored in the <a href="https://github.com/camunda/camunda/blob/main/.github/renovate.json" target="_blank" rel="noopener noreferrer" class="">Renovate configuration file</a>?</strong></p>
<blockquote>
<p>A: The reasons for manually ignoring certain updates should be described in the comments. Using <code>git annotate</code> to figure out who put the ignore can also be a way to get more details.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ci-health-metrics">CI Health Metrics<a href="#ci-health-metrics" class="hash-link" aria-label="Direct link to CI Health Metrics" title="Direct link to CI Health Metrics" translate="no">​</a></h2>
<p>There are hundreds of CI jobs running each day in the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> due to high development activity. This scale makes it challenging to assess whether there are any structural problems related to the &quot;CI health&quot; (e.g. reliability issues) that would impact developer productivity.</p>
<p>To achieve that for CI jobs we can collect metrics like build times, build failures and information about the hardware/runner via the <a href="https://confluence.camunda.com/display/HAN/CI+Analytics" target="_blank" rel="noopener noreferrer" class="">CI Analytics framework</a>. See <a href="#metrics-collection" class="">how to instrument GHA workflows for metrics collection</a>. We use the collected data for <a href="#visualization" class="">visualizations</a> to get an overview of the CI health.</p>
<p>This topic is work-in-progress as part of <a href="https://github.com/camunda/camunda/issues/18210" target="_blank" rel="noopener noreferrer" class="">#18210</a> to achieve better coverage, collect more different metrics for additional insights and establish a process for dealing with the results.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics-collection">Metrics Collection<a href="#metrics-collection" class="hash-link" aria-label="Direct link to Metrics Collection" title="Direct link to Metrics Collection" translate="no">​</a></h3>
<p>Any job in any GitHub Actions workflow can be instrumented to collect information about the build status by adding one step at the end, like the following snippet shows:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">my-solo-job-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># initial checkout is required!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># keep all other steps here, then insert final step:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Observe build status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">continue-on-error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.github/actions/observe</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">build_status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> job.status </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ADDR </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_roleId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ROLE_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_secretId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_SECRET_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Special handling has to be done <a href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs" target="_blank" rel="noopener noreferrer" class="">for <code>matrix</code> jobs</a> since the job name is not unique among the different matrix builds, see below:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">my-matrix-job-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matrix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">identifier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">configurationA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> configurationB</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># initial checkout is required!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># keep all other steps here, then insert final step:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Observe build status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">continue-on-error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./.github/actions/observe</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${{ env.GITHUB_JOB }}/${{ matrix.identifier }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">build_status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> job.status </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ADDR </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_roleId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ROLE_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">secret_vault_secretId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_SECRET_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://github.com/search?q=repo%3Acamunda%2Fcamunda+github%2Factions%2Fobserve-build-status&amp;type=code" target="_blank" rel="noopener noreferrer" class="">other examples using <code>observe-build-status</code></a></li>
<li class=""><code>observe-build-status</code> uses <a href="https://github.com/camunda/infra-global-github-actions/tree/main/submit-build-status" target="_blank" rel="noopener noreferrer" class=""><code>submit-build-status</code> action</a> (documentation) under the hood</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="visualization">Visualization<a href="#visualization" class="hash-link" aria-label="Direct link to Visualization" title="Direct link to Visualization" translate="no">​</a></h3>
<p>We visualize the collected data using <a href="https://dashboard.int.camunda.com/d/bdmo5l8puugaoc/ci-health-camunda-camunda-monorepo" target="_blank" rel="noopener noreferrer" class="">an internal Grafana dashboard</a> to analyze for high build failure rates in general and breakdowns per CI job.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://dashboard.int.camunda.com/d/bdmo5l8puugaoc/ci-health-camunda-camunda-monorepo" target="_blank" rel="noopener noreferrer" class="">CI Health Grafana dashboard (internal)</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ci-secret-management">CI Secret Management<a href="#ci-secret-management" class="hash-link" aria-label="Direct link to CI Secret Management" title="Direct link to CI Secret Management" translate="no">​</a></h2>
<p>All GitHub Action workflows of the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> must use <a href="https://confluence.camunda.com/display/HAN/CI+Secrets+Self-Service#CISecretsSelfService-GitHubActions" target="_blank" rel="noopener noreferrer" class="">Vault</a> to retrieve secrets e.g. with the <a href="https://github.com/hashicorp/vault-action" target="_blank" rel="noopener noreferrer" class="">Hashicorp Vault action</a> as a best practice. Other approaches like <a href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions" target="_blank" rel="noopener noreferrer" class="">GitHub Action Secrets</a> will be <a href="https://github.com/camunda/camunda/issues/18211" target="_blank" rel="noopener noreferrer" class="">sunset</a> (outside of bootstrapping connection to Vault).</p>
<p>Historically, <a href="https://github.com/search?q=repo%3Acamunda%2Fcamunda+%22secret%2Fdata%2F%22&amp;type=code" target="_blank" rel="noopener noreferrer" class="">different paths</a> have been used in Vault to store secrets depending on the managing team, e.g. <code>products/zeebe/ci</code> or <code>products/operate/ci</code>. This scheme can lead to redundancies in a monorepo and should be aligned for more synergy.</p>
<p>Secrets for the <a href="https://github.com/camunda/camunda/actions" target="_blank" rel="noopener noreferrer" class="">C8 monorepo CI</a> should be stored in Vault under the path <code>products/camunda/ci/*</code>. Manually managed secrets should go into <code>products/camunda/ci/github-actions</code>.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://confluence.camunda.com/display/HAN/CI+Secrets+Self-Service#CISecretsSelfService-GitHubActions" target="_blank" rel="noopener noreferrer" class="">Vault for GitHub Actions (internal)</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ci-self-hosted-runners">CI Self-Hosted Runners<a href="#ci-self-hosted-runners" class="hash-link" aria-label="Direct link to CI Self-Hosted Runners" title="Direct link to CI Self-Hosted Runners" translate="no">​</a></h2>
<p>GitHub offers customers to use their own machines to execute GitHub Action workflows via <a href="https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners" target="_blank" rel="noopener noreferrer" class="">self-hosted runners</a>. We use this feature in cases when more resources are needed than what GitHub can provide or at a cheaper price. See the <a href="https://confluence.camunda.com/display/HAN/Github+Actions+Self-Hosted+Runners" target="_blank" rel="noopener noreferrer" class="">internal documentation</a> for what is available.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-guidelines">Usage Guidelines<a href="#usage-guidelines" class="hash-link" aria-label="Direct link to Usage Guidelines" title="Direct link to Usage Guidelines" translate="no">​</a></h3>
<p>How to choose which runner to use for a GHA workflow:</p>
<ol>
<li class="">Use <a href="https://docs.github.com/en/actions/using-github-hosted-runners/using-github-hosted-runners" target="_blank" rel="noopener noreferrer" class="">GitHub-hosted runners</a> by default (free for public repositories)</li>
<li class="">Use self-hosted runners (with <code>-default</code> name suffix) when a workflow needs:<!-- -->
<ol>
<li class="">more resources (memory, CPU) than available on GitHub-hosted runners</li>
<li class="">ARM CPU architecture</li>
</ol>
</li>
</ol>
<p>The <code>-default</code> self-hosted runners have no durability guarantees which makes them very cheap and the default choice, if GitHub-hosted runners are not sufficient. <strong>Exceptions:</strong> in case of reliability problems one can use the <code>-longrunning</code> suffix after approval by Monorepo CI DRI.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="github-actions-cache">GitHub Actions Cache<a href="#github-actions-cache" class="hash-link" aria-label="Direct link to GitHub Actions Cache" title="Direct link to GitHub Actions Cache" translate="no">​</a></h2>
<p>Workflows run by GitHub Actions can avoid repeated downloads of tools and dependencies by using <a href="https://docs.github.com/en/actions/reference/workflows-and-actions/dependency-caching" target="_blank" rel="noopener noreferrer" class="">GitHub Actions Cache</a>. This can shorten or avoid download times, make workflow executions faster, more robust and cheaper.</p>
<p>There is a <a href="https://github.blog/changelog/2023-04-10-manage-caches-in-your-actions-workflows-from-web-interface/" target="_blank" rel="noopener noreferrer" class="">web UI available and a CLI which can be used to view, analyze and delete corrupted cache entries</a>.</p>
<p>Important facts about the GHA cache:</p>
<ul>
<li class=""><strong>size</strong>: 10 GiB<!-- -->
<ul>
<li class="">this is small for a monorepo usecase with Java, NodeJS, and many open PRs</li>
</ul>
</li>
<li class=""><strong>access restrictions</strong>: <a href="https://docs.github.com/en/actions/reference/workflows-and-actions/dependency-caching#restrictions-for-accessing-a-cache" target="_blank" rel="noopener noreferrer" class="">workflow runs can restore caches created in either the current branch or the default branch</a>
<ul>
<li class="">caches created for <code>main</code> are very useful</li>
<li class="">caches created on other branches/Pull Requests are of very limited use, can only be used on subsequent builds of same PR</li>
</ul>
</li>
<li class=""><strong>cleaning policy</strong>: GitHub will immediately delete old cache entries when we exceed the 10 GiB total size<!-- -->
<ul>
<li class="">counter-intuitive: caches from <code>main</code> (more useful than those from PRs) are deleted first if they are the oldest</li>
</ul>
</li>
</ul>
<p>Metrics on cache usage are available in <a href="https://dashboard.int.camunda.com/d/bdmo5l8puugaoc/ci-health-camunda-camunda-monorepo" target="_blank" rel="noopener noreferrer" class="">CI Health Grafana dashboard (internal)</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="caching-strategy">Caching Strategy<a href="#caching-strategy" class="hash-link" aria-label="Direct link to Caching Strategy" title="Direct link to Caching Strategy" translate="no">​</a></h3>
<p>To make the most efficient use of the limited GHA cache resources available in the monorepo and ensure consistency across many GHA workflows, we follow these guidelines:</p>
<ol>
<li class="">Docker/BuildKit layers: <strong>don&#x27;t</strong> write to the GHA cache</li>
<li class="">Java/Maven dependencies: <strong>do</strong> write to the GHA cache <strong>only</strong> from <code>main</code> and <code>stable*</code> branch builds</li>
<li class="">NPM/Yarn dependencies: <strong>do</strong> write to the GHA cache <strong>only</strong> from <code>main</code> and <code>stable*</code> branch builds</li>
<li class="">Golang dependencies: <strong>do</strong> write to the GHA cache <strong>only</strong> from <code>main</code> and <code>stable*</code> branch builds</li>
<li class="">CodeQL automation by GitHub: writes to the GHA cache from Pull Requests (speeds up analysis)</li>
</ol>
<p>Implementation:</p>
<ol>
<li class="">Do <strong>not</strong> use <code>cache-from: type=gha</code> and <code>cache-to: type=gha</code> parameters of <a href="https://docs.docker.com/build/ci/github-actions/cache/" target="_blank" rel="noopener noreferrer" class="">docker/build-push-action</a>.</li>
<li class="">Use <a href="https://github.com/camunda/camunda/tree/main/.github/actions/setup-maven-cache" target="_blank" rel="noopener noreferrer" class="">setup-maven-cache</a> action.</li>
<li class="">Use <a href="https://github.com/camunda/infra-global-github-actions/tree/main/setup-yarn-cache" target="_blank" rel="noopener noreferrer" class="">setup-yarn-cache</a> action, see <a href="https://github.com/camunda/camunda/pull/21607" target="_blank" rel="noopener noreferrer" class="">usage example in #21607</a>.</li>
<li class="">No implementation since Golang usage is low.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="disable-cache-restoration-for-a-pull-request">Disable cache restoration for a Pull Request<a href="#disable-cache-restoration-for-a-pull-request" class="hash-link" aria-label="Direct link to Disable cache restoration for a Pull Request" title="Direct link to Disable cache restoration for a Pull Request" translate="no">​</a></h3>
<p>You can temporarily turn off cache restore functionality in a PR by using the <code>/ci-disable-cache</code> command as described under <a href="#chatops" class="">ChatOps</a>. This could be useful to test GHA workflows without the caching mechanism. To restore standard functionality, you need to issue the <code>/ci-enable-cache</code> command or drop the empty commit.</p>
<p><strong>Note</strong>: Disabling cache restore mechanism is only possible on PRs.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ci-security">CI Security<a href="#ci-security" class="hash-link" aria-label="Direct link to CI Security" title="Direct link to CI Security" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="permissions-of-github_token">Permissions of <code>GITHUB_TOKEN</code><a href="#permissions-of-github_token" class="hash-link" aria-label="Direct link to permissions-of-github_token" title="Direct link to permissions-of-github_token" translate="no">​</a></h3>
<p>Every GHA workflow job is given a <code>GITHUB_TOKEN</code> environment variable with a valid GitHub API token by default. This token can have wide permissions which are unnecessary but open up <em>attack surface</em>, reducing security.</p>
<p><strong>Best Practice:</strong> All GHA workflow jobs must request only actually required <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/controlling-permissions-for-github_token" target="_blank" rel="noopener noreferrer" class="">permissions on the <code>GITHUB_TOKEN</code></a>. Set <code>permissions: {}</code> by default and add what is needed.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-of-third-party-github-actions">Usage of Third Party GitHub Actions<a href="#usage-of-third-party-github-actions" class="hash-link" aria-label="Direct link to Usage of Third Party GitHub Actions" title="Direct link to Usage of Third Party GitHub Actions" translate="no">​</a></h3>
<p>GitHub Actions has a <a href="https://github.com/marketplace" target="_blank" rel="noopener noreferrer" class="">large ecosystem of existing useful actions</a> from GitHub and third parties such as other companies and individuals. While reusing existing actions avoids code duplication and maintenance effort for Camunda, it increases the <em>attack surface</em> should any of those actions be hacked to perform malicious tasks.</p>
<p><strong>Best Practice:</strong> To balance utility with risk, all GHA workflows must follow this policy:</p>
<ul>
<li class="">Use the same action for the same (or similar) automation task, see <a href="https://github.com/camunda/github-actions-recipes" target="_blank" rel="noopener noreferrer" class="">recipes</a>.</li>
<li class="">Use actions only from trusted sources (GitHub or small set of select 3rd parties, <a href="https://github.com/camunda/camunda/settings/actions" target="_blank" rel="noopener noreferrer" class="">settings</a>).</li>
<li class="">Move actions from Camundi personal accounts to <code>camunda</code> for long-term maintenance, or find replacement.</li>
</ul>
<p>For <code>camunda/camunda</code> GHA workflows we use a GitHub feature to <a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository#allowing-select-actions-and-reusable-workflows-to-run" target="_blank" rel="noopener noreferrer" class="">technically limit which actions can be used</a> to:</p>
<ul>
<li class="">Allow actions created by GitHub in the <code>actions</code> and <code>github</code> organizations.</li>
<li class="">Allow actions in any <a href="https://github.com/enterprises/camunda/organizations" target="_blank" rel="noopener noreferrer" class="">Camunda GitHub Enterprise organization</a> like <code>camunda</code>, <code>bpmn-io</code>, etc.</li>
<li class="">Allow specific actions from 3rd parties that we need (full list see below).</li>
</ul>
<p>If you need to use a 3rd party action not on the list, <a href="#issue-tracking" class="">create an issue</a> explaining the motivation and tag the Monorepo CI DRI for further discussion.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Details</summary><div><div class="collapsibleContent_i85q"><p></p><summary>List of allowed 3rd party actions and reusable workflows</summary>
EnricoMi/publish-unit-test-result-action@<em>,
YunaBraska/java-info-action@</em>,
asdf-vm/actions/install@<em>,
atomicjar/testcontainers-cloud-setup-action@</em>,
aws-actions/configure-aws-credentials@<em>,
blombard/move-to-next-iteration@</em>,
bobheadxi/deployments@<em>,
browser-actions/setup-firefox@</em>,
bufbuild/buf-action@<em>,
cloudposse/github-action-matrix-outputs-read@</em>,
cloudposse/github-action-matrix-outputs-write@<em>,
codex-/return-dispatch@</em>,
dcarbone/install-jq-action@<em>,
deadsnakes/action@</em>,
dlavrenuek/conventional-changelog-action@<em>,
docker/build-push-action@</em>,
docker/login-action@<em>,
docker/metadata-action@</em>,
docker/setup-buildx-action@<em>,
docker/setup-qemu-action@</em>,
dorny/paths-filter@<em>,
fjogeleit/http-request-action@</em>,
geekyeggo/delete-artifact@<em>,
golangci/golangci-lint-action@</em>,
google-github-actions/auth@<em>,
google-github-actions/get-gke-credentials@</em>,
google-github-actions/setup-gcloud@<em>,
hadolint/hadolint-action@</em>,
hashicorp/vault-action@<em>,
hoverkraft-tech/compose-action@</em>,
jamesives/github-pages-deploy-action@<em>,
joelanford/go-apidiff@</em>,
jwalton/gh-docker-logs@<em>,
korthout/backport-action@</em>,
marocchino/sticky-pull-request-comment@<em>,
mavrosxristoforos/get-xml-info@</em>,
misiekhardcore/infra-report-action@<em>,
mshick/add-pr-comment@</em>,
mxschmitt/action-tmate@<em>,
ncipollo/release-action@</em>,
nick-fields/retry@<em>,
octokit/</em>@<em>,
peter-evans/create-or-update-comment@</em>,
peter-evans/find-comment@<em>,
peter-evans/slash-command-dispatch@</em>,
redhat-actions/oc-login@<em>,
requarks/changelog-action@</em>,
rodrigo-lourenco-lopes/move-to-current-iteration@<em>,
rossjrw/pr-preview-action@</em>,
s4u/maven-settings-action@<em>,
s4u/setup-maven-action@</em>,
slackapi/slack-github-action@<em>,
snyk/actions/setup@</em>,
stCarolas/setup-maven@<em>,
stefanzweifel/git-auto-commit-action@</em>,
teleport-actions/auth-k8s@<em>,
teleport-actions/setup@</em>,
test-summary/action@<em>,
tibdex/github-app-token@</em>,
wagoid/commitlint-github-action@*,<p></p></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="preview-environments">Preview Environments<a href="#preview-environments" class="hash-link" aria-label="Direct link to Preview Environments" title="Direct link to Preview Environments" translate="no">​</a></h2>
<p>Engineers can request Preview Environments for specific Pull Requests of the C8 monorepo to be available via a designated URL, to allow more thorough testing and demonstration of the product features before the feature branches are merged into the base branch. For the C8 monorepo the components Identity, Operate, Optimize, Tasklist and Zeebe will get provisioned based on the <a href="https://github.com/camunda/camunda-platform-helm/" target="_blank" rel="noopener noreferrer" class="">camunda-platform</a> Helm chart.</p>
<p>Assign the <a href="https://github.com/camunda/camunda/labels/deploy-preview" target="_blank" rel="noopener noreferrer" class=""><code>deploy-preview</code></a> label to any PR to request creation of a Preview Environment. The following base branches are supported, with their corresponding Helm chart versions:</p>
<ul>
<li class=""><code>main</code> (uses Helm chart version camunda-platform-8.8-13.x)</li>
<li class=""><code>stable/8.8</code> (uses Helm chart version camunda-platform-8.8-13.x)</li>
<li class=""><code>stable/8.7</code> (uses Helm chart version camunda-platform-8.7-12.x)</li>
<li class=""><code>stable/optimize-8.7</code> (uses Helm chart version camunda-platform-8.7-12.x)</li>
</ul>
<p>Creation may take a while and a PR comment including an URL and additional info will be sent as notification. The creation/update of a Preview Environment may fail for various reasons including:</p>
<ul>
<li class="">compilation errors on any code in the C8 monorepo</li>
<li class="">Docker image build errors</li>
<li class="">backwards incompatible changes in the upstream <a href="https://github.com/camunda/camunda-platform-helm/" target="_blank" rel="noopener noreferrer" class="">camunda-platform</a> Helm chart</li>
<li class="">bugs preventing successful startup of any included C8 component</li>
</ul>
<p>Preview Environments are provisioned on cheap but sometimes less reliable hardware to be cost efficient, and can get automatically stopped after inactivity.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://confluence.camunda.com/display/HAN/Preview+Environments" target="_blank" rel="noopener noreferrer" class="">internal documentation</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="backporting-guidelines">Backporting Guidelines<a href="#backporting-guidelines" class="hash-link" aria-label="Direct link to Backporting Guidelines" title="Direct link to Backporting Guidelines" translate="no">​</a></h2>
<p>We want crucial security, stability, cost, and other CI improvements applied to all <a href="#git-branches" class="">long-living Git branches</a> in the C8 monorepo.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-we-need-ci-backports">Why we need CI backports<a href="#why-we-need-ci-backports" class="hash-link" aria-label="Direct link to Why we need CI backports" title="Direct link to Why we need CI backports" translate="no">​</a></h3>
<p>Changes affecting the CI such as introducing new jobs, new observability features or stability fixes are usually developed first on the <code>main</code> <a href="#git-branches" class="">branch</a>. We also have several <code>stable/*</code> <a href="#git-branches" class="">branches</a> living for multiple years to release maintenance updates.</p>
<p>Due to how Git branches work, every <code>stable/*</code> branch has its own copy of all GHA workflows at the time of forking. Those GHA workflows receive automated <a href="#renovate" class="">Renovate updates</a> for actions. But every human-made CI change  needs to be at least <a href="#when-to-backport-ci-changes" class="">considered for manual backporting</a> to ensure that crucial improvements are on all relevant branches.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-backport-ci-changes">How to backport CI changes<a href="#how-to-backport-ci-changes" class="hash-link" aria-label="Direct link to How to backport CI changes" title="Direct link to How to backport CI changes" translate="no">​</a></h3>
<p>Follow <a href="https://github.com/camunda/camunda/blob/main/CONTRIBUTING.md#backporting-changes" target="_blank" rel="noopener noreferrer" class="">these instructions</a> to backport PRs with CI changes.</p>
<p>It may be required to resolve Git conflicts when backporting CI changes.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-backport-ci-changes">When to backport CI changes<a href="#when-to-backport-ci-changes" class="hash-link" aria-label="Direct link to When to backport CI changes" title="Direct link to When to backport CI changes" translate="no">​</a></h3>
<p>If the CI change matches one of the following:</p>
<ul>
<li class="">is security-related (incl dependency updates, permissions): <strong>MUST</strong> backport to all <code>stable/*</code> branches<!-- -->
<ul>
<li class="">e.g. related are <a href="#ci-security" class="">CI Security</a>, <a href="#ci-secret-management" class="">secrets</a></li>
</ul>
</li>
<li class="">is related to cost reduction, increased reliability or observability: <strong>SHOULD</strong> backport to all <code>stable/*</code> branches<!-- -->
<ul>
<li class="">e.g. related are <a href="#ci-health-metrics" class="">CI health</a>, <a href="#caching-strategy" class="">GHA caching</a>, <a href="#ci-self-hosted-runners" class="">self-hosted runners</a></li>
</ul>
</li>
<li class="">is an in-repository documentation change: <strong>SHOULD</strong> backport if it:<!-- -->
<ul>
<li class="">updates procedures, guidelines, or troubleshooting steps that AI agents need for accurate assistance on stable branches</li>
<li class="">fixes incorrect information that would mislead AI agents or developers working on stable versions</li>
<li class="">adds new knowledge about practices, tools, or procedures that apply to stable branch development</li>
<li class="">corrects build, test, or development instructions that affect stable branch workflows</li>
</ul>
</li>
<li class="">is a new CI job for new product feature or test cases: backport <strong>only if</strong> the product feature is backported</li>
<li class="">is a new CI feature: backport <strong>only if</strong> required in the ticket</li>
<li class="">is related to an <code>on: schedule</code> GHA workflow: <strong>no need</strong> to backport, only works on <code>main</code></li>
<li class="">is related to <a href="#preview-environments" class="">Preview Environments</a>: <strong>no need</strong> to backport, only supported on <code>main</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="slack-notifications">Slack Notifications<a href="#slack-notifications" class="hash-link" aria-label="Direct link to Slack Notifications" title="Direct link to Slack Notifications" translate="no">​</a></h2>
<p>All CI workflows in the <a href="https://github.com/camunda/camunda" target="_blank" rel="noopener noreferrer" class="">camunda/camunda monorepo</a> must use the <a href="https://api.slack.com/apps/A086JM3CTB7/incoming-webhooks" target="_blank" rel="noopener noreferrer" class="">&quot;C8 Monorepo Notifications&quot; Slack app</a>. Messages to Slack should be send via webhooks. The webhook URLs are <a href="#ci-secret-management" class="">secrets</a> and stored in <a href="https://vault.int.camunda.com/ui/vault/secrets/secret/kv/products%2Fcamunda%2Fci%2Fgithub-actions" target="_blank" rel="noopener noreferrer" class="">Vault</a> for each Slack channel.</p>
<p>If you need to send Slack messages to a channel for which no webhook URL exists yet, reach out via Slack to the Monorepo CI DRI to request one. They then will generate a new webhook URL for the <a href="https://api.slack.com/apps/A086JM3CTB7/incoming-webhooks" target="_blank" rel="noopener noreferrer" class="">&quot;C8 Monorepo Notifications&quot; Slack app</a> and store it in <a href="https://vault.int.camunda.com/ui/vault/secrets/secret/kv/products%2Fcamunda%2Fci%2Fgithub-actions" target="_blank" rel="noopener noreferrer" class="">Vault</a>.</p>
<p>Webhook URL secrets can be retrieved from <a href="https://vault.int.camunda.com/ui/vault/secrets/secret/kv/products%2Fcamunda%2Fci%2Fgithub-actions" target="_blank" rel="noopener noreferrer" class="">Vault</a> in GitHub Actions workflows like this:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">job-with-notification</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Import Secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hashicorp/vault</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ADDR </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> approle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">roleId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_ROLE_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secretId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.VAULT_SECRET_ID </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exportEnv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># we rely on step outputs, no need for environment variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          secret/data/products/camunda/ci/github-actions SLACK_MYCHANNELNAME_WEBHOOK_URL;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Send notification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slackapi/slack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">webhook</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> steps.secrets.outputs.SLACK_MYCHANNELNAME_WEBHOOK_URL </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">webhook-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> webhook</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">trigger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># For posting a rich message using Block Kit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          blocks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            - type: &quot;section&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">              text:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                type: &quot;mrkdwn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                text: &quot;Hello World&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="chatops">ChatOps<a href="#chatops" class="hash-link" aria-label="Direct link to ChatOps" title="Direct link to ChatOps" translate="no">​</a></h2>
<p>In the <a href="https://github.com/camunda/camunda" target="_blank" rel="noopener noreferrer" class="">camunda/camunda monorepo</a> certain automated workflows can be triggered by posting comments with commands on GitHub Issues and/or Pull Requests. Those commands are then processed by a <a href="https://github.com/camunda/camunda/blob/main/.github/workflows/chatops-command-dispatch.yml" target="_blank" rel="noopener noreferrer" class="">GitHub Actions workflow</a>.</p>
<p>Available commands:</p>
<ul>
<li class=""><code>/ci-problems</code> comment on a Pull Request:<!-- -->
<ul>
<li class="">Synopsis: Triggers a <a href="https://github.com/camunda/camunda/blob/main/.ci/chatops-commands/ci-problems-analyze.sh" target="_blank" rel="noopener noreferrer" class="">script</a> that analyzes all CI runs related to that PR for CI failures and posts summary as new PR comment.</li>
<li class="">Use case: Can be used by any engineer to get actionable hints on how to address CI problems in a PR.</li>
<li class="">Capabilities:<!-- -->
<ul>
<li class="">detect problems with self-hosted runners (incl links to dashboards + Kubernetes logs)</li>
<li class="">pipeline timeouts</li>
<li class="">DockerHub connection problems</li>
<li class="">deep links to GHA logs for generic job failures</li>
</ul>
</li>
</ul>
</li>
<li class=""><code>/ci-disable-cache</code> comment on a Pull Request:<!-- -->
<ul>
<li class="">Synopsis: Adds a new label <code>ci:no-cache</code> to the list of labels of the Pull Request and creates a new empty commit to trigger a new CI run without cache restoration.</li>
<li class="">Use case: Can be used by any engineer to test workflows run from scratch without cache restoration.</li>
</ul>
</li>
<li class=""><code>/ci-enable-cache</code> comment on a Pull Request:<!-- -->
<ul>
<li class="">Synopsis: Removes the <code>ci:no-cache</code> label from the list of labels of the Pull Request and creates a new empty commit to trigger a new CI run.</li>
<li class="">Use case: Complements the <code>/ci-disable-cache</code> commands and can be used to restore CI regular cache restoration step.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="flaky-tests">Flaky tests<a href="#flaky-tests" class="hash-link" aria-label="Direct link to Flaky tests" title="Direct link to Flaky tests" translate="no">​</a></h2>
<p>Tests can be viewed as &quot;flaky&quot; when they are not consistenly passing although neither the source code, nor the test code, nor the environment has been meaningfully changed.</p>
<p>We should aim to have all tests consistently passing, avoid introducing new flaky tests and implement our <a href="#ci-health-metrics" class="">observability tooling</a> to detect and improve existing flaky tests. This allows for better developer experience and smoother processes like <a href="#renovate" class="">automated dependency updates</a>.</p>
<p>GitHub Action workflows with Maven testing Java code should use the <a href="#flaky-test-extractor-maven-plugin" class="">flaky-test-extractor-maven-plugin</a> and report the resulting <a href="https://github.com/camunda/camunda/issues/26930" target="_blank" rel="noopener noreferrer" class="">detailed flaky test statistics</a> to our <a href="#ci-health-metrics" class="">CI health</a> database.</p>
<p>Related resources:</p>
<ul>
<li class=""><a href="https://dashboard.int.camunda.com/d/ae2j69npxh3b4f/flaky-tests-camunda-camunda-monorepo" target="_blank" rel="noopener noreferrer" class="">the Flaky tests dashboard (internal)</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flaky-test-extractor-maven-plugin">flaky-test-extractor-maven-plugin<a href="#flaky-test-extractor-maven-plugin" class="hash-link" aria-label="Direct link to flaky-test-extractor-maven-plugin" title="Direct link to flaky-test-extractor-maven-plugin" translate="no">​</a></h3>
<p>Some Maven modules in the monorepo <a href="https://maven.apache.org/surefire/maven-surefire-plugin/examples/rerun-failing-tests.html" target="_blank" rel="noopener noreferrer" class="">rerun failing Java tests multiple times</a> (e.g. 3 times, configurable) when they fail and use the <a href="https://github.com/zeebe-io/flaky-test-extractor-maven-plugin" target="_blank" rel="noopener noreferrer" class="">flaky-test-extractor-maven-plugin</a>:</p>
<ul>
<li class="">if a test succeeds at least once during the retries, it is classified as &quot;flaky&quot; by this plugin<!-- -->
<ul>
<li class="">flaky tests get reported via <a href="#ci-health-metrics" class="">CI Health metrics</a> and can be viewed on <a href="https://dashboard.int.camunda.com/d/ae2j69npxh3b4f/flaky-tests-camunda-camunda-monorepo" target="_blank" rel="noopener noreferrer" class="">the Flaky tests dashboard</a></li>
<li class=""><strong>flaky tests do not cause build failures</strong></li>
</ul>
</li>
<li class="">if a test fails on all retries, it is classified as &quot;failed&quot;<!-- -->
<ul>
<li class="">this will cause the whole build to fail</li>
<li class="">see <a href="#faq" class="">the FAQ</a> on how to deal with such cases</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="license-checks">License Checks<a href="#license-checks" class="hash-link" aria-label="Direct link to License Checks" title="Direct link to License Checks" translate="no">​</a></h2>
<p>We use <a href="https://app.fossa.com/" target="_blank" rel="noopener noreferrer" class="">FOSSA</a> to check dependencies for license compliance with Camunda&#x27;s policies in order to detect risks early and be aware of licenses of our BOM.</p>
<p>The scan is performed by a GitHub Actions workflows for:</p>
<ul>
<li class="">each tag</li>
<li class="">each commit pushed to <code>main</code> and <code>stable*</code> (8.6+) branches</li>
<li class="">each Pull Request opened against the above branches</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-deal-with-ci-alerts-that-fire">How to deal with CI alerts that fire?<a href="#how-to-deal-with-ci-alerts-that-fire" class="hash-link" aria-label="Direct link to How to deal with CI alerts that fire?" title="Direct link to How to deal with CI alerts that fire?" translate="no">​</a></h3>
<p>Follow the Monorepo CI medic routines and check out the available <a href="https://github.com/camunda/camunda/wiki/CI-Runbooks" target="_blank" rel="noopener noreferrer" class="">CI runbooks</a> for each alert.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-is-my-ci-check-failing">Why is my CI check failing?<a href="#why-is-my-ci-check-failing" class="hash-link" aria-label="Direct link to Why is my CI check failing?" title="Direct link to Why is my CI check failing?" translate="no">​</a></h3>
<p>There can be many factors influencing that and it is sometimes hard to find the root caues. Below list should provide guidance:</p>
<ol>
<li class="">Try to rerun the failing CI check(s) at least to overcome transient problems.</li>
<li class="">If on a Pull Request, consider whether the code changes on that Pull Request might cause the CI check failure.</li>
<li class="">Check if there is an <a href="#issue-tracking" class="">open issue</a> about that failing CI check, e.g. by searching for the error message.</li>
<li class=""><a href="https://github.blog/changelog/2025-01-15-copilot-users-can-ask-about-a-failed-actions-job-ga/" target="_blank" rel="noopener noreferrer" class="">Ask Copilot about the failure</a> using the <code>Explain error</code> button<!-- -->
<ul>
<li class="">If this doesn&#x27;t work, find and google the error message.</li>
</ul>
</li>
<li class="">If the failing CI checks are <strong>not</strong> part of the <a href="#unified-ci" class="">Unified CI</a>, contact their <a href="#ci-test-files" class="">owner</a> and see if those CI checks are known to be unstable or flaky.<!-- -->
<ul>
<li class="">Technically, failing CI checks <strong>outside</strong> the Unified CI do not prevent merging a PR. If the owners of those failing CI checks agree, you can still merge.</li>
</ul>
</li>
<li class="">If your PR is removed from the merge queue, check if concurrently there was another PR merged that changes code which your code depends on (e.g. leading to compilation errors in the merge queue).</li>
<li class="">If a check from the Unified CI is failing on <code>main</code> or a stable branch, try to find the <a href="https://github.com/camunda/camunda/actions/workflows/ci.yml?query=branch%3Amain" target="_blank" rel="noopener noreferrer" class="">first build</a> with that failing check and investigate the recently merged code changes.<!-- -->
<ul>
<li class="">Experience shows that most CI check failures are (indirectly) caused by <code>camunda/camunda</code> code changes, and not by external factors like 3rd party services or infrastructure.</li>
<li class=""><a href="#ci-health-metrics" class="">CI Health metrics</a> can also be used to narrow down the time range, less precise.</li>
</ul>
</li>
<li class="">Reach out on Slack for help!</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-verify-that-a-ci-check-is-robust-and-stable-not-flaky">How to verify that a CI check is robust and stable, not flaky?<a href="#how-to-verify-that-a-ci-check-is-robust-and-stable-not-flaky" class="hash-link" aria-label="Direct link to How to verify that a CI check is robust and stable, not flaky?" title="Direct link to How to verify that a CI check is robust and stable, not flaky?" translate="no">​</a></h3>
<p>First, create a dedicated branch <code>YOURBRANCHNAME</code> which can be used as a reference for running the CI check later.</p>
<p>If you are working on fixing a <a href="#flaky-tests" class="">flaky test</a>, push the code or build pipeline change(s) that you believe remove the flakiness onto that branch.</p>
<p>Is your CI check part of the <a href="#unified-ci" class="">Unified CI&#x27;s</a> <code>ci.yml</code>?</p>
<ol>
<li class="">
<p>No, but it runs on Pull Requests. Then you have to create a draft PR for <code>YOURBRANCHNAME</code> and manually trigger reruns of the check in question.</p>
</li>
<li class="">
<p>Yes! Then you can use the <a href="https://cli.github.com/" target="_blank" rel="noopener noreferrer" class="">GitHub CLI tool</a> to start repeated runs.</p>
<p><em>Optional: remove CI checks you are not interested in from the <code>ci.yml</code> on <code>YOURBRANCHNAME</code> to speed up the execution and save resources.</em></p>
<p>Open a new terminal, go to your checkout of <code>camunda/camunda</code> and execute in <code>bash</code> shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for i in {1..10}; do gh workflow run ci.yml --ref YOURBRANCHNAME; done</span><br></span></code></pre></div></div>
<p>This loop will take a while (1 hour or more depending on the CI check) so let it run in the background. After it finished, visit <a href="https://github.com/camunda/camunda/actions/workflows/ci.yml?query=branch%3AYOURBRANCHNAME" target="_blank" rel="noopener noreferrer" class="">https://github.com/camunda/camunda/actions/workflows/ci.yml?query=branch%3AYOURBRANCHNAME</a> and see if there are any failures (indicates lack of robustness).</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/camunda/camunda/tree/main/docs/monorepo-docs/../docs/monorepo-docs/ci.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/camunda/pr-preview/pr-44066/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Camunda Platform Documentation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/camunda/pr-preview/pr-44066/release/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Release Process</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#git-branches" class="table-of-contents__link toc-highlight">Git Branches</a><ul><li><a href="#available-snapshot-artifacts" class="table-of-contents__link toc-highlight">Available SNAPSHOT Artifacts</a></li></ul></li><li><a href="#issue-tracking" class="table-of-contents__link toc-highlight">Issue Tracking</a><ul><li><a href="#prioritization" class="table-of-contents__link toc-highlight">Prioritization</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></li><li><a href="#github-merge-queue" class="table-of-contents__link toc-highlight">GitHub Merge Queue</a><ul><li><a href="#faq-1" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></li><li><a href="#unified-ci" class="table-of-contents__link toc-highlight">Unified CI</a><ul><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#workflow-inclusion-criteria" class="table-of-contents__link toc-highlight">Workflow Inclusion Criteria</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li></ul></li><li><a href="#ci-test-files" class="table-of-contents__link toc-highlight">CI Test Files</a><ul><li><a href="#ownership" class="table-of-contents__link toc-highlight">Ownership</a></li><li><a href="#legacy-ci" class="table-of-contents__link toc-highlight">Legacy CI</a></li><li><a href="#consolidated-unit-tests" class="table-of-contents__link toc-highlight">Consolidated Unit Tests</a></li><li><a href="#naming-conventions" class="table-of-contents__link toc-highlight">Naming Conventions</a></li></ul></li><li><a href="#renovate" class="table-of-contents__link toc-highlight">Renovate</a><ul><li><a href="#faq-2" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></li><li><a href="#ci-health-metrics" class="table-of-contents__link toc-highlight">CI Health Metrics</a><ul><li><a href="#metrics-collection" class="table-of-contents__link toc-highlight">Metrics Collection</a></li><li><a href="#visualization" class="table-of-contents__link toc-highlight">Visualization</a></li></ul></li><li><a href="#ci-secret-management" class="table-of-contents__link toc-highlight">CI Secret Management</a></li><li><a href="#ci-self-hosted-runners" class="table-of-contents__link toc-highlight">CI Self-Hosted Runners</a><ul><li><a href="#usage-guidelines" class="table-of-contents__link toc-highlight">Usage Guidelines</a></li></ul></li><li><a href="#github-actions-cache" class="table-of-contents__link toc-highlight">GitHub Actions Cache</a><ul><li><a href="#caching-strategy" class="table-of-contents__link toc-highlight">Caching Strategy</a></li><li><a href="#disable-cache-restoration-for-a-pull-request" class="table-of-contents__link toc-highlight">Disable cache restoration for a Pull Request</a></li></ul></li><li><a href="#ci-security" class="table-of-contents__link toc-highlight">CI Security</a><ul><li><a href="#permissions-of-github_token" class="table-of-contents__link toc-highlight">Permissions of <code>GITHUB_TOKEN</code></a></li><li><a href="#usage-of-third-party-github-actions" class="table-of-contents__link toc-highlight">Usage of Third Party GitHub Actions</a></li></ul></li><li><a href="#preview-environments" class="table-of-contents__link toc-highlight">Preview Environments</a></li><li><a href="#backporting-guidelines" class="table-of-contents__link toc-highlight">Backporting Guidelines</a><ul><li><a href="#why-we-need-ci-backports" class="table-of-contents__link toc-highlight">Why we need CI backports</a></li><li><a href="#how-to-backport-ci-changes" class="table-of-contents__link toc-highlight">How to backport CI changes</a></li><li><a href="#when-to-backport-ci-changes" class="table-of-contents__link toc-highlight">When to backport CI changes</a></li></ul></li><li><a href="#slack-notifications" class="table-of-contents__link toc-highlight">Slack Notifications</a></li><li><a href="#chatops" class="table-of-contents__link toc-highlight">ChatOps</a></li><li><a href="#flaky-tests" class="table-of-contents__link toc-highlight">Flaky tests</a><ul><li><a href="#flaky-test-extractor-maven-plugin" class="table-of-contents__link toc-highlight">flaky-test-extractor-maven-plugin</a></li></ul></li><li><a href="#license-checks" class="table-of-contents__link toc-highlight">License Checks</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#how-to-deal-with-ci-alerts-that-fire" class="table-of-contents__link toc-highlight">How to deal with CI alerts that fire?</a></li><li><a href="#why-is-my-ci-check-failing" class="table-of-contents__link toc-highlight">Why is my CI check failing?</a></li><li><a href="#how-to-verify-that-a-ci-check-is-robust-and-stable-not-flaky" class="table-of-contents__link toc-highlight">How to verify that a CI check is robust and stable, not flaky?</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Camunda.</div></div></div></footer></div>
</body>
</html>