# Process definition domain schemas
ProcessDefinitionSearchQuerySortRequest:
  type: object
  properties:
    field:
      description: The field to sort by.
      type: string
      enum:
        - processDefinitionKey
        - name
        - resourceName
        - version
        - versionTag
        - processDefinitionId
        - tenantId
    order:
      $ref: '../common/enums.yaml#/SortOrderEnum'
  required:
    - field

ProcessDefinitionSearchQuery:
  type: object
  additionalProperties: false
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryRequest'
  properties:
    sort:
      description: Sort field criteria.
      type: array
      items:
        $ref: '#/ProcessDefinitionSearchQuerySortRequest'
    filter:
      $ref: '#/ProcessDefinitionFilter'
      description: The process definition search filters.

ProcessDefinitionFilter:
  description: Process definition search filter.
  type: object
  properties:
    name:
      $ref: '../common/filters.yaml#/StringFilterProperty'
      description: Name of this process definition.
    isLatestVersion:
      description: |
        Whether to only return the latest version of each process definition.
        When using this filter, pagination functionality is limited, you can only paginate forward using `after` and `limit`.
        The response contains no `startCursor` in the `page`, and requests ignore the `from` and `before` in the `page`.
      type: boolean
    resourceName:
      description: Resource name of this process definition.
      type: string
    version:
      description: Version of this process definition.
      type: integer
      format: int32
    versionTag:
      description: Version tag of this process definition.
      type: string
    processDefinitionId:
      $ref: '../common/filters.yaml#/StringFilterProperty'
      description: Process definition ID of this process definition.
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
      description: Tenant ID of this process definition.
    processDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessDefinitionKey'
      description: The key for this process definition.
    hasStartForm:
      description: Indicates whether the start event of the process has an associated Form Key.
      type: boolean

ProcessDefinitionSearchQueryResult:
  type: object
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryResponse'
  properties:
    items:
      description: The matching process definitions.
      type: array
      items:
        $ref: '#/ProcessDefinitionResult'

ProcessDefinitionResult:
  type: object
  properties:
    name:
      description: Name of this process definition.
      type: string
    resourceName:
      description: Resource name for this process definition.
      type: string
    version:
      description: Version of this process definition.
      type: integer
      format: int32
    versionTag:
      description: Version tag of this process definition.
      type: string
    processDefinitionId:
      $ref: '../common/identifiers.yaml#/ProcessDefinitionId'
      description: Process definition ID of this process definition.
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
      description: Tenant ID of this process definition.
    processDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessDefinitionKey'
      description: The key for this process definition.
    hasStartForm:
      description: Indicates whether the start event of the process has an associated Form Key.
      type: boolean

ProcessDefinitionElementStatisticsQuery:
  description: Process definition element statistics request.
  type: object
  additionalProperties: false
  properties:
    filter:
      $ref: './process-instance-models.yaml#/ProcessDefinitionStatisticsFilter'
      description: The process definition statistics search filters.

ProcessDefinitionElementStatisticsQueryResult:
  description: Process definition element statistics query response.
  type: object
  properties:
    items:
      description: The element statistics.
      type: array
      items:
        $ref: '#/ProcessElementStatisticsResult'

ProcessElementStatisticsResult:
  description: Process element statistics response.
  type: object
  properties:
    elementId:
      $ref: '../common/identifiers.yaml#/ElementId'
      description: The element ID for which the results are aggregated.
    active:
      description: The total number of active instances of the element.
      type: integer
      format: int64
    canceled:
      description: The total number of canceled instances of the element.
      type: integer
      format: int64
    incidents:
      description: The total number of incidents for the element.
      type: integer
      format: int64
    completed:
      description: The total number of completed instances of the element.
      type: integer
      format: int64

ProcessDefinitionInstanceStatisticsQuery:
  type: object
  properties:
    page:
      description: Pagination criteria.
      allOf:
        - $ref: '#/ProcessDefinitionInstanceStatisticsPageRequest'
    sort:
      description: Sort field criteria.
      type: array
      items:
        $ref: '#/ProcessDefinitionInstanceStatisticsQuerySortRequest'
    filter:
      description: The process definition instance statistics filters.
      allOf:
        - $ref: '../processes/process-instance-models.yaml#/ProcessInstanceFilter'

ProcessDefinitionInstanceStatisticsQueryResult:
  type: object
  description: Process definition instance statistics query response.
  properties:
    items:
      description: The process definition instance statistics result.
      type: array
      items:
        $ref: '#/ProcessDefinitionInstanceStatisticsResult'
    page:
      $ref: '#/ProcessDefinitionInstanceStatisticsPageResponse'
      description: Pagination information about the search results.

ProcessDefinitionInstanceStatisticsResult:
  description: Process definition instance statistics response.
  type: object
  properties:
    processDefinitionId:
      $ref: '../common/identifiers.yaml#/ProcessDefinitionId'
    latestProcessDefinitionName:
      description: Name of the latest deployed process definition instance version.
      type: string
    hasMultipleVersions:
      description: Indicates whether multiple versions of this process definition instance are deployed.
      type: boolean
    activeInstancesWithoutIncidentCount:
      description: Total number of currently active process instances of this definition that do not have incidents.
      type: integer
      format: int64
    activeInstancesWithIncidentCount:
      description: Total number of currently active process instances of this definition that have at least one incident.
      type: integer
      format: int64

ProcessDefinitionInstanceStatisticsQuerySortRequest:
  type: object
  properties:
    field:
      description: The field to sort by.
      type: string
      enum:
        - processDefinitionId
        - activeInstancesWithIncident
        - activeInstancesWithoutIncident
    order:
      $ref: '../common/enums.yaml#/SortOrderEnum'
  required:
    - field

ProcessDefinitionInstanceStatisticsPageRequest:
  type: object
  properties:
    from:
      description: The index of items to start searching from.
      type: integer
      format: int32
    limit:
      description: The maximum number of items to return in one request.
      type: integer
      default: 100

ProcessDefinitionInstanceStatisticsPageResponse:
  description: Pagination information about the search results.
  type: object
  properties:
    totalItems:
      description: Total items matching the criteria.
      type: integer
      format: int64
    hasMoreTotalItems:
      description: Indicates whether there are more items matching the criteria.
      type: boolean
