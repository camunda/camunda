# Decision instance domain schemas
DecisionInstanceSearchQuerySortRequest:
  type: object
  properties:
    field:
      description: The field to sort by.
      type: string
      enum:
        - decisionDefinitionId
        - decisionDefinitionKey
        - decisionDefinitionName
        - decisionDefinitionType
        - decisionDefinitionVersion
        - decisionEvaluationInstanceKey
        - decisionEvaluationKey
        - elementInstanceKey
        - evaluationDate
        - evaluationFailure
        - processDefinitionKey
        - processInstanceKey
        - rootDecisionDefinitionKey
        - state
        - tenantId
    order:
      $ref: '../common/enums.yaml#/SortOrderEnum'
  required:
    - field

DecisionInstanceSearchQuery:
  type: object
  additionalProperties: false
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryRequest'
  properties:
    sort:
      description: Sort field criteria.
      type: array
      items:
        $ref: '#/DecisionInstanceSearchQuerySortRequest'
    filter:
      $ref: '#/DecisionInstanceFilter'
      description: The decision instance search filters.

DecisionInstanceFilter:
  description: Decision instance search filter.
  type: object
  properties:
    decisionEvaluationInstanceKey:
      $ref: '../common/keys.yaml#/DecisionEvaluationInstanceKey'
    state:
      $ref: '../common/enums.yaml#/DecisionInstanceStateEnum'
    evaluationFailure:
      type: string
      description: The evaluation failure of the decision instance.
    evaluationDate:
      description: The evaluation date of the decision instance.
      allOf:
        - $ref: '../common/filters.yaml#/DateTimeFilterProperty'
    decisionDefinitionId:
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
      description: The ID of the DMN decision.
    decisionDefinitionName:
      type: string
      description: The name of the DMN decision.
    decisionDefinitionVersion:
      type: integer
      format: int32
      description: The version of the decision.
    decisionDefinitionType:
      $ref: '../common/enums.yaml#/DecisionDefinitionTypeEnum'
    tenantId:
      description: The tenant ID of the decision instance.
      allOf:
        - $ref: '../common/identifiers.yaml#/TenantId'
    decisionEvaluationKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionEvaluationKey'
      description: >
        The key of the parent decision evaluation. Note that this is not the identifier of
        an individual decision instance; the `decisionEvaluationInstanceKey` is the identifier
        for a decision instance.
    processDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessDefinitionKey'
      description: The key of the process definition.
    processInstanceKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessInstanceKey'
      description: The key of the process instance.
    decisionDefinitionKey:
      description: The key of the decision.
      allOf:
        - $ref: '../common/filters.yaml#/DecisionDefinitionKeyFilterProperty'
    elementInstanceKey:
      description: The key of the element instance this decision instance is linked to.
      allOf:
        - $ref: '../common/filters.yaml#/ElementInstanceKeyFilterProperty'
    rootDecisionDefinitionKey:
      description: The key of the root decision definition.
      allOf:
        - $ref: '../common/filters.yaml#/DecisionDefinitionKeyFilterProperty'

DecisionInstanceSearchQueryResult:
  type: object
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryResponse'
  properties:
    items:
      description: The matching decision instances.
      type: array
      items:
        $ref: '#/DecisionInstanceResult'

DecisionInstanceResult:
  type: object
  properties:
    decisionEvaluationInstanceKey:
      $ref: '../common/keys.yaml#/DecisionEvaluationInstanceKey'
    state:
      $ref: '../common/enums.yaml#/DecisionInstanceStateEnum'
    evaluationDate:
      type: string
      format: date-time
      description: The evaluation date of the decision instance.
    evaluationFailure:
      type: string
      description: The evaluation failure of the decision instance.
    decisionDefinitionId:
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
      description: The ID of the DMN decision.
    decisionDefinitionName:
      type: string
      description: The name of the DMN decision.
    decisionDefinitionVersion:
      type: integer
      format: int32
      description: The version of the decision.
    decisionDefinitionType:
      $ref: '../common/enums.yaml#/DecisionDefinitionTypeEnum'
    result:
      type: string
      description: The result of the decision instance.
    tenantId:
      description: The tenant ID of the decision instance.
      allOf:
        - $ref: '../common/identifiers.yaml#/TenantId'
    decisionEvaluationKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionEvaluationKey'
      description: The key of the decision evaluation where this instance was created.
    processDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessDefinitionKey'
      description: The key of the process definition.
    processInstanceKey:
      allOf:
        - $ref: '../common/keys.yaml#/ProcessInstanceKey'
      description: The key of the process instance.
    decisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The key of the decision.
    elementInstanceKey:
      description: The key of the element instance this decision instance is linked to.
      allOf:
        - $ref: '../common/keys.yaml#/ElementInstanceKey'
    rootDecisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The key of the root decision definition.

DecisionInstanceGetQueryResult:
  allOf:
    - $ref: "#/DecisionInstanceResult"
    - type: object
      properties:
        evaluatedInputs:
          type: array
          items:
            $ref: "#/EvaluatedDecisionInputItem"
          description: |
            The evaluated inputs of the decision instance.
        matchedRules:
          type: array
          items:
            $ref: "#/MatchedDecisionRuleItem"
          description: |
            The matched rules of the decision instance.

EvaluatedDecisionInputItem:
  type: object
  description: A decision input that was evaluated within this decision evaluation.
  properties:
    inputId:
      type: string
    inputName:
      type: string
    inputValue:
      type: string

EvaluatedDecisionOutputItem:
  type: object
  description: The evaluated decision outputs.
  properties:
    outputId:
      type: string
    outputName:
      type: string
    outputValue:
      type: string
    ruleId:
      type: string
    ruleIndex:
      type: integer
      format: int32

MatchedDecisionRuleItem:
  type: object
  description: A decision rule that matched within this decision evaluation.
  properties:
    ruleId:
      description: The ID of the matched rule.
      type: string
    ruleIndex:
      description: The index of the matched rule.
      type: integer
      format: int32
    evaluatedOutputs:
      description: The evaluated decision outputs.
      type: array
      items:
        $ref: './decision-instance-models.yaml#/EvaluatedDecisionOutputItem'
