# Decision definition domain schemas
DecisionDefinitionSearchQuerySortRequest:
  type: object
  properties:
    field:
      description: The field to sort by.
      type: string
      enum:
        - decisionDefinitionKey
        - decisionDefinitionId
        - name
        - version
        - decisionRequirementsId
        - decisionRequirementsKey
        - tenantId
    order:
      $ref: '../common/enums.yaml#/SortOrderEnum'
  required:
    - field

DecisionDefinitionSearchQuery:
  type: object
  additionalProperties: false
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryRequest'
  properties:
    sort:
      description: Sort field criteria.
      type: array
      items:
        $ref: '#/DecisionDefinitionSearchQuerySortRequest'
    filter:
      $ref: '#/DecisionDefinitionFilter'
      description: The decision definition search filters.

DecisionDefinitionFilter:
  description: Decision definition search filter.
  type: object
  properties:
    decisionDefinitionId:
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
      description: The DMN ID of the decision definition.
    name:
      type: string
      description: The DMN name of the decision definition.
    version:
      type: integer
      description: The assigned version of the decision definition.
    decisionRequirementsId:
      type: string
      description: the DMN ID of the decision requirements graph that the decision definition is part of.
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
      description: The tenant ID of the decision definition.
    decisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The assigned key, which acts as a unique identifier for this decision definition.
    decisionRequirementsKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionRequirementsKey'
      description: The assigned key of the decision requirements graph that the decision definition is part of.

DecisionDefinitionSearchQueryResult:
  type: object
  allOf:
    - $ref: '../search/search-models.yaml#/SearchQueryResponse'
  properties:
    items:
      description: The matching decision definitions.
      type: array
      items:
        $ref: '#/DecisionDefinitionResult'

DecisionDefinitionResult:
  type: object
  properties:
    decisionDefinitionId:
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
      description: The DMN ID of the decision definition.
    name:
      type: string
      description: The DMN name of the decision definition.
    version:
      type: integer
      description: The assigned version of the decision definition.
    decisionRequirementsId:
      type: string
      description: the DMN ID of the decision requirements graph that the decision definition is part of.
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
      description: The tenant ID of the decision definition.
    decisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The assigned key, which acts as a unique identifier for this decision definition.
    decisionRequirementsKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionRequirementsKey'
      description: The assigned key of the decision requirements graph that the decision definition is part of.

DecisionEvaluationInstruction:
  x-polymorphic-schema: true
  type: object
  oneOf:
    - $ref: '#/DecisionEvaluationById'
    - $ref: '#/DecisionEvaluationByKey'

DecisionEvaluationById:
  type: object
  additionalProperties: false
  title: Decision evaluation by ID
  properties:
    decisionDefinitionId:
      $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
    variables:
      type: object
      additionalProperties: true
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
  required:
    - decisionDefinitionId

DecisionEvaluationByKey:
  type: object
  title: Decision evaluation by key
  additionalProperties: false
  properties:
    decisionDefinitionKey:
      $ref: '../common/keys.yaml#/DecisionDefinitionKey'
    variables:
      type: object
      additionalProperties: true
      description: The message variables as JSON document.
    tenantId:
      $ref: '../common/identifiers.yaml#/TenantId'
  required:
    - decisionDefinitionKey

EvaluateDecisionResult:
  x-semantic-provider:
    - decisionEvaluationKey
  type: object
  required:
    - decisionDefinitionId
    - decisionDefinitionName
    - decisionDefinitionVersion
    - decisionRequirementsId
    - output
    - failedDecisionDefinitionId
    - failureMessage
    - decisionDefinitionKey
    - tenantId
    - decisionRequirementsKey
    - decisionEvaluationKey
    - evaluatedDecisions
  properties:
    decisionDefinitionId:
      description: The ID of the decision which was evaluated.
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
    decisionDefinitionName:
      description: The name of the decision which was evaluated.
      type: string
    decisionDefinitionVersion:
      description: The version of the decision which was evaluated.
      type: integer
      format: int32
    decisionRequirementsId:
      description: The ID of the decision requirements graph that the decision which was evaluated is part of.
      type: string
    output:
      description: |
        JSON document that will instantiate the result of the decision which was evaluated.
      type: string
    failedDecisionDefinitionId:
      description: The ID of the decision which failed during evaluation.
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
    failureMessage:
      description: Message describing why the decision which was evaluated failed.
      type: string
    tenantId:
      description: The tenant ID of the evaluated decision.
      allOf:
        - $ref: '../common/identifiers.yaml#/TenantId'
    decisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The unique key identifying the decision which was evaluated.
    decisionRequirementsKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionRequirementsKey'
      description: The unique key identifying the decision requirements graph that the decision which was evaluated is part of.
    decisionInstanceKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionInstanceKey'
      description: Deprecated, please refer to `decisionEvaluationKey`.
      deprecated: true
    decisionEvaluationKey:
      description: The unique key identifying this decision evaluation.
      allOf:
        - $ref: '../common/keys.yaml#/DecisionEvaluationKey'
    evaluatedDecisions:
      description: Decisions that were evaluated within the requested decision evaluation.
      type: array
      items:
        $ref: "#/EvaluatedDecisionResult"

EvaluatedDecisionResult:
  x-semantic-provider:
    - decisionEvaluationInstanceKey
  type: object
  description: A decision that was evaluated.
  properties:
    decisionDefinitionId:
      description: The ID of the decision which was evaluated.
      allOf:
        - $ref: '../common/identifiers.yaml#/DecisionDefinitionId'
    decisionDefinitionName:
      description: The name of the decision which was evaluated.
      type: string
    decisionDefinitionVersion:
      description: The version of the decision which was evaluated.
      type: integer
      format: int32
    decisionDefinitionType:
      description: The type of the decision which was evaluated.
      type: string
    output:
      description: |
        JSON document that will instantiate the result of the decision which was evaluated.
      type: string
    tenantId:
      description: The tenant ID of the evaluated decision.
      allOf:
        - $ref: '../common/identifiers.yaml#/TenantId'
    matchedRules:
      description: The decision rules that matched within this decision evaluation.
      type: array
      items:
        $ref: './decision-instance-models.yaml#/MatchedDecisionRuleItem'
    evaluatedInputs:
      description: The decision inputs that were evaluated within this decision evaluation.
      type: array
      items:
        $ref: './decision-instance-models.yaml#/EvaluatedDecisionInputItem'
    decisionDefinitionKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionDefinitionKey'
      description: The unique key identifying the decision which was evaluate.
    decisionEvaluationInstanceKey:
      allOf:
        - $ref: '../common/keys.yaml#/DecisionEvaluationInstanceKey'
      description: The unique key identifying this decision evaluation instance.
