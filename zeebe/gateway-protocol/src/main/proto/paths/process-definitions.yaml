# Process definition endpoints
/process-definitions/search:
  post:
    tags:
      - Process definition
    operationId: searchProcessDefinitions
    summary: Search process definitions
    description: Search for process definitions based on given criteria.
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionSearchQuery'
    responses:
      "200":
        description: The process definition search result.
        content:
          application/json:
            schema:
              $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionSearchQueryResult'
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
    x-eventually-consistent: true

/process-definitions/{processDefinitionKey}:
  get:
    tags:
      - Process definition
    operationId: getProcessDefinition
    summary: Get process definition
    description: Returns process definition as JSON.
    parameters:
      - name: processDefinitionKey
        in: path
        required: true
        description: >
          The assigned key of the process definition, which acts as a unique identifier for this
          process definition.
        schema:
          $ref: '../schemas/common/keys.yaml#/ProcessDefinitionKey'
    responses:
      "200":
        description: The process definition is successfully returned.
        content:
          application/json:
            schema:
              $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionResult'
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "404":
        description: >
          The process definition with the given key was not found.
          More details are provided in the response body.
        content:
          application/problem+json:
            schema:
              $ref: '../schemas/common/problem-detail.yaml#/ProblemDetail'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
    x-eventually-consistent: true

/process-definitions/{processDefinitionKey}/xml:
  get:
    tags:
      - Process definition
    operationId: getProcessDefinitionXML
    summary: Get process definition XML
    description: Returns process definition as XML.
    parameters:
      - name: processDefinitionKey
        in: path
        required: true
        description: |
          The assigned key of the process definition, which acts as a unique identifier for this process definition.
        schema:
          $ref: '../schemas/common/keys.yaml#/ProcessDefinitionKey'
    responses:
      "200":
        description: The XML of the process definition is successfully returned.
        content:
          text/xml:
            schema:
              type: string
      "204":
        description: The process definition was found but does not have XML.
        content:
          text/plain:
            schema:
              type: string
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "404":
        description: |
          The process definition with the given key was not found.
          More details are provided in the response body.
        content:
          application/problem+json:
            schema:
              $ref: '../schemas/common/problem-detail.yaml#/ProblemDetail'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
    x-eventually-consistent: true

/process-definitions/{processDefinitionKey}/form:
  get:
    tags:
      - Process definition
    operationId: getStartProcessForm
    summary: Get process start form
    description: |
      Get the start form of a process.
      Note that this endpoint will only return linked forms. This endpoint does not support embedded forms.
    parameters:
      - name: processDefinitionKey
        in: path
        required: true
        description: The process key.
        schema:
          $ref: '../schemas/common/keys.yaml#/ProcessDefinitionKey'
    responses:
      "200":
        description: The form is successfully returned.
        content:
          application/json:
            schema:
              $ref: '../schemas/forms/form-models.yaml#/FormResult'
      "204":
        description: The process was found, but no form is associated with it.
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "404":
        description: Not found
        content:
          application/problem+json:
            schema:
              $ref: '../schemas/common/problem-detail.yaml#/ProblemDetail'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
    x-eventually-consistent: true

/process-definitions/{processDefinitionKey}/statistics/element-instances:
  post:
    tags:
      - Process definition
    operationId: getProcessDefinitionStatistics
    summary: Get process definition statistics
    description: Get statistics about elements in currently running process instances by process definition key and search filter.
    parameters:
      - name: processDefinitionKey
        in: path
        required: true
        description: The assigned key of the process definition, which acts as a unique identifier for this process definition.
        schema:
          $ref: '../schemas/common/keys.yaml#/ProcessDefinitionKey'
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionElementStatisticsQuery'
    responses:
      "200":
        description: The process definition statistics result.
        content:
          application/json:
            schema:
              $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionElementStatisticsQueryResult'
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
    x-eventually-consistent: true

/process-definitions/statistics/process-instances:
  post:
    tags:
      - Process definition
    operationId: getProcessDefinitionInstanceStatistics
    summary: Get statistics for process instances by process definition
    description: |
      Get statistics about process instances, grouped by process definition. For each process
      definition, the response includes the latest deployed instance name, total counts of active
      instances without incident, total counts of active instances with incident and whether the
      instance has more than one version.
    requestBody:
      required: false
      content:
        application/json:
          schema:
            $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionInstanceStatisticsQuery'
    responses:
      "200":
        description: The process definition instance statistic result.
        content:
          application/json:
            schema:
              $ref: '../schemas/processes/process-definition-models.yaml#/ProcessDefinitionInstanceStatisticsQueryResult'
      "400":
        $ref: '../responses/common-responses.yaml#/InvalidData'
      "401":
        $ref: '../responses/common-responses.yaml#/Unauthorized'
      "403":
        $ref: '../responses/common-responses.yaml#/Forbidden'
      "500":
        $ref: '../responses/common-responses.yaml#/InternalServerError'
