## Endpoint definitions
paths:
  /audit-logs/search:
    post:
      x-eventually-consistent: true
      tags:
        - Audit Log
      operationId: searchAuditLogs
      summary: Search audit logs
      description: Search for audit logs based on given criteria.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditLogSearchQueryRequest'
      responses:
        "200":
          description: The audit logs search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogSearchQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          description: An internal error occurred while processing the request.

  /audit-logs/{auditLogKey}:
    get:
      x-eventually-consistent: true
      tags:
        - Audit Log
      operationId: getAuditLog
      summary: Get audit log
      description: Get an audit log entry by auditLogKey.
      parameters:
        - name: auditLogKey
          in: path
          required: true
          description: The audit log key.
          schema:
            $ref: 'keys.yaml#/components/schemas/AuditLogKey'
      responses:
        "200":
          description: The audit log entry is successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogResult'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The audit log with the given key was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

## Schema definitions

components:
  schemas:
    AuditLogResult:
      description: Audit log item.
      type: object
      properties:
        auditLogKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/AuditLogKey'
          description: The unique key of the audit log entry.
        entityKey:
          $ref: '#/components/schemas/AuditLogEntityKey'
        entityType:
          $ref: '#/components/schemas/AuditLogEntityTypeEnum'
        operationType:
          $ref: '#/components/schemas/AuditLogOperationTypeEnum'
        batchOperationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/BatchOperationKey'
          description: Key of the batch operation.
        batchOperationType:
          allOf:
            - $ref: 'batch-operations.yaml#/components/schemas/BatchOperationTypeEnum'
          description: The type of batch operation performed, if this is part of a batch.
        timestamp:
          type: string
          description: The timestamp when the operation occurred.
          format: date-time
        actorId:
          type: string
          description: The ID of the actor who performed the operation.
        actorType:
          $ref: '#/components/schemas/AuditLogActorTypeEnum'
        tenantId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID of the audit log.
        result:
          $ref: '#/components/schemas/AuditLogResultEnum'
        annotation:
          type: string
          description: Additional notes about the operation.
        category:
          $ref: '#/components/schemas/AuditLogCategoryEnum'
        processDefinitionId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/ProcessDefinitionId'
          description: The process definition ID.
        processDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKey'
          description: The key of the process definition.
        processInstanceKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessInstanceKey'
          description: The key of the process instance.
        elementInstanceKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ElementInstanceKey'
          description: The key of the element instance.
        jobKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/JobKey'
          description: The key of the job.
        userTaskKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/UserTaskKey'
          description: The key of the user task.
        decisionRequirementsId:
          type: string
          description: The decision requirements ID.
        decisionRequirementsKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionRequirementsKey'
          description: The assigned key of the decision requirements.
        decisionDefinitionId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/DecisionDefinitionId'
          description: The decision definition ID.
        decisionDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionDefinitionKey'
          description: The key of the decision definition.
        decisionEvaluationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionEvaluationKey'
          description: The key of the decision evaluation.
        deploymentKey:
          allOf:
            - $ref: 'deployments.yaml#/components/schemas/DeploymentKey'
          description: The key of the deployment.
        formKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/FormKey'
          description: The key of the form.
        resourceKey:
          allOf:
            - $ref: 'deployments.yaml#/components/schemas/ResourceKey'
          description: The system-assigned key for this resource.
        relatedEntityKey:
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityKey'
          description: The key of the related entity.
        relatedEntityType:
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityTypeEnum'
          description: The type of the related entity.
        entityDescription:
          type: string
          description: Additional description of the entity affected by the operation.

    AuditLogSearchQuerySortRequest:
      type: object
      additionalProperties: false
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - actorId
            - actorType
            - annotation
            - auditLogKey
            - batchOperationKey
            - batchOperationType
            - category
            - decisionDefinitionId
            - decisionDefinitionKey
            - decisionEvaluationKey
            - decisionRequirementsId
            - decisionRequirementsKey
            - elementInstanceKey
            - entityKey
            - entityType
            - jobKey
            - operationType
            - processDefinitionId
            - processDefinitionKey
            - processInstanceKey
            - result
            - tenantId
            - timestamp
            - userTaskKey
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    AuditLogSearchQueryRequest:
      description: Audit log search request.
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogSearchQuerySortRequest'
        filter:
          allOf:
            - $ref: '#/components/schemas/AuditLogFilter'
          description: The audit log search filters.

    AuditLogFilter:
      description: Audit log filter request
      type: object
      properties:
        auditLogKey:
          description: The audit log key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/AuditLogKeyFilterProperty'
        processDefinitionKey:
          description: The process definition key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKeyFilterProperty'
        processInstanceKey:
          description: The process instance key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessInstanceKeyFilterProperty'
        elementInstanceKey:
          description: The element instance key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ElementInstanceKeyFilterProperty'
        operationType:
          description: The operation type search filter.
          allOf:
            - $ref: '#/components/schemas/OperationTypeFilterProperty'
        result:
          description: The result search filter.
          allOf:
            - $ref: '#/components/schemas/AuditLogResultFilterProperty'
        timestamp:
          description: The timestamp search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/DateTimeFilterProperty'
        actorId:
          description: The actor ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        actorType:
          description: The actor type search filter.
          allOf:
            - $ref: '#/components/schemas/AuditLogActorTypeFilterProperty'
        entityKey:
          description: The entity key search filter.
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityKeyFilterProperty'
        entityType:
          description: The entity type search filter.
          allOf:
            - $ref: '#/components/schemas/EntityTypeFilterProperty'
        tenantId:
          description: The tenant ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        category:
          description: The category search filter.
          allOf:
            - $ref: '#/components/schemas/CategoryFilterProperty'
        deploymentKey:
          description: The deployment key search filter.
          allOf:
            - $ref: 'deployments.yaml#/components/schemas/DeploymentKeyFilterProperty'
        formKey:
          description: The form key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/FormKeyFilterProperty'
        resourceKey:
          description: The resource key search filter.
          allOf:
            - $ref: 'deployments.yaml#/components/schemas/ResourceKeyFilterProperty'
        batchOperationType:
          description: The batch operation type search filter.
          allOf:
            - $ref: 'batch-operations.yaml#/components/schemas/BatchOperationTypeFilterProperty'
        processDefinitionId:
          description: The process definition ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        jobKey:
          description: The job key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/JobKeyFilterProperty'
        userTaskKey:
          description: The user task key search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/BasicStringFilterProperty'
        decisionRequirementsId:
          description: The decision requirements ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        decisionRequirementsKey:
          description: The decision requirements key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionRequirementsKeyFilterProperty'
        decisionDefinitionId:
          description: The decision definition ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        decisionDefinitionKey:
          description: The decision definition key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionDefinitionKeyFilterProperty'
        decisionEvaluationKey:
          description: The decision evaluation key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionEvaluationKeyFilterProperty'
        relatedEntityKey:
          description: The related entity key search filter.
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityKeyFilterProperty'
        relatedEntityType:
          description: The related entity type search filter.
          allOf:
            - $ref: '#/components/schemas/EntityTypeFilterProperty'
        entityDescription:
          description: The entity description filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'

    AuditLogSearchQueryResult:
      description: Audit log search response.
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching audit logs.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogResult'

    AuditLogEntityKey:
      description: System-generated entity key for an audit log entry.
      format: AuditLogEntityKey
      x-semantic-type: AuditLogEntityKey
      example: "22517998136843567"
      type: string

    ## Enums

    AuditLogEntityTypeEnum:
      type: string
      description: The type of entity affected by the operation.
      enum:
        - AUTHORIZATION
        - BATCH
        - DECISION
        - GROUP
        - INCIDENT
        - MAPPING_RULE
        - PROCESS_INSTANCE
        - RESOURCE
        - ROLE
        - TENANT
        - USER
        - USER_TASK
        - VARIABLE

    AuditLogOperationTypeEnum:
      type: string
      description: The type of operation performed.
      enum:
        - ASSIGN
        - CANCEL
        - COMPLETE
        - CREATE
        - DELETE
        - EVALUATE
        - MIGRATE
        - MODIFY
        - RESOLVE
        - RESUME
        - SUSPEND
        - UNASSIGN
        - UNKNOWN
        - UPDATE

    AuditLogActorTypeEnum:
      type: string
      description: The type of actor who performed the operation.
      enum:
        - ANONYMOUS
        - CLIENT
        - UNKNOWN
        - USER

    AuditLogResultEnum:
      type: string
      description: The result status of the operation.
      enum:
        - FAIL
        - SUCCESS

    AuditLogCategoryEnum:
      type: string
      description: The category of the audit log operation.
      enum:
        - ADMIN
        - DEPLOYED_RESOURCES
        - USER_TASKS

    ## Filters

    AuditLogEntityKeyFilterProperty:
      description: EntityKey property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: "#/components/schemas/AuditLogEntityKey"
        - $ref: '#/components/schemas/AdvancedAuditLogEntityKeyFilter'

    AdvancedAuditLogEntityKeyFilter:
      title: Advanced filter
      description: Advanced entityKey filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: "#/components/schemas/AuditLogEntityKey"
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: "#/components/schemas/AuditLogEntityKey"
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: "#/components/schemas/AuditLogEntityKey"
        $notIn:
          description: Checks if the property matches none of the provided values.
          type: array
          items:
            $ref: "#/components/schemas/AuditLogEntityKey"

    EntityTypeFilterProperty:
      description: AuditLogEntityTypeEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: "#/components/schemas/AuditLogEntityTypeEnum"
        - $ref: '#/components/schemas/AdvancedEntityTypeFilter'

    AdvancedEntityTypeFilter:
      title: Advanced filter
      description: Advanced AuditLogEntityTypeEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityTypeEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityTypeEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogEntityTypeEnum'
        $like:
          $ref: 'filters.yaml#/components/schemas/LikeFilter'

    OperationTypeFilterProperty:
      description: AuditLogOperationTypeEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: "#/components/schemas/AuditLogOperationTypeEnum"
        - $ref: '#/components/schemas/AdvancedOperationTypeFilter'

    AdvancedOperationTypeFilter:
      title: Advanced filter
      description: Advanced AuditLogOperationTypeEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogOperationTypeEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogOperationTypeEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogOperationTypeEnum'
        $like:
          $ref: 'filters.yaml#/components/schemas/LikeFilter'

    CategoryFilterProperty:
      description: AuditLogCategoryEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: '#/components/schemas/AuditLogCategoryEnum'
        - $ref: '#/components/schemas/AdvancedCategoryFilter'

    AdvancedCategoryFilter:
      title: Advanced filter
      description: Advanced AuditLogCategoryEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogCategoryEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogCategoryEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogCategoryEnum'
        $like:
          $ref: 'filters.yaml#/components/schemas/LikeFilter'

    AuditLogResultFilterProperty:
      description: AuditLogResultEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: '#/components/schemas/AuditLogResultEnum'
        - $ref: '#/components/schemas/AdvancedResultFilter'

    AdvancedResultFilter:
      title: Advanced filter
      description: Advanced AuditLogResultEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogResultEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogResultEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogResultEnum'
        $like:
          $ref: 'filters.yaml#/components/schemas/LikeFilter'

    AuditLogActorTypeFilterProperty:
      description: AuditLogActorTypeEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: '#/components/schemas/AuditLogActorTypeEnum'
        - $ref: '#/components/schemas/AdvancedActorTypeFilter'

    AdvancedActorTypeFilter:
      title: Advanced filter
      description: Advanced AuditLogActorTypeEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogActorTypeEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/AuditLogActorTypeEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogActorTypeEnum'
        $like:
          $ref: 'filters.yaml#/components/schemas/LikeFilter'
