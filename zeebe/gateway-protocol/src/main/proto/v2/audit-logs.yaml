## Endpoint definitions
paths:
  /audit-logs/search:
    post:
      x-eventually-consistent: true
      tags:
        - Audit Log
      operationId: searchAuditLogs
      summary: Search audit logs
      description: Search for audit logs based on given criteria.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditLogSearchQueryRequest'
      responses:
        "200":
          description: The audit logs search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogSearchQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          description: An internal error occurred while processing the request.

  /audit-logs/{operationKey}:
    get:
      x-eventually-consistent: true
      tags:
        - Audit Log
      operationId: getAuditLog
      summary: Get audit log
      description: Get an audit log by operationKey.
      parameters:
        - name: operationKey
          in: path
          required: true
          description: The audit log operation key.
          schema:
            $ref: 'keys.yaml#/components/schemas/AuditLogOperationKey'
      responses:
        "200":
          description: The audit log is successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogResult'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The audit log with the given operation key was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

## Schema definitions

components:
  schemas:
    AuditLogResult:
      description: Audit log item.
      type: object
      properties:
        operationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/AuditLogOperationKey'
          description: The unique operation key of the audit log entry.
        entityKey:
          type: string
          description: The key of the entity this audit log refers to.
        entityType:
          allOf:
            - $ref: '#/components/schemas/AuditLogEntityTypeEnum'
          description: The type of the entity.
        operationType:
          allOf:
            - $ref: '#/components/schemas/AuditLogOperationTypeEnum'
          description: The type of operation performed.
        batchOperationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/BatchOperationKey'
          description: Key of the batch operation.
        batchOperationType:
          allOf:
            - $ref: '#/components/schemas/AuditLogBatchOperationTypeEnum'
          description: The type of batch operation performed, if this is part of a batch.
        timestamp:
          type: integer
          format: int64
          description: The timestamp when the operation occurred.
        actorId:
          type: string
          description: The ID of the actor who performed the operation.
        actorType:
          allOf:
            - $ref: '#/components/schemas/AuditLogActorTypeEnum'
          description: The type of the actor.
        tenantId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID of the audit log.
        operationStatus:
          allOf:
            - $ref: '#/components/schemas/AuditLogOperationStatusEnum'
          description: The status of the operation.
        annotation:
          type: string
          description: Additional notes about the operation.
        category:
          allOf:
            - $ref: '#/components/schemas/AuditLogCategoryEnum'
          description: The category of the operation.
        processDefinitionId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/ProcessDefinitionId'
          description: The process definition ID.
        processDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKey'
          description: The key of the process definition.
        processInstanceKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessInstanceKey'
          description: The key of the process instance.
        elementInstanceKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ElementInstanceKey'
          description: The key of the element instance.
        jobKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/JobKey'
          description: The key of the job.
        userTaskKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/UserTaskKey'
          description: The key of the user task.
        decisionRequirementsId:
          type: string
          description: The decision requirements ID.
        decisionRequirementsKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionRequirementsKey'
          description: The assigned key of the decision requirements.
        decisionDefinitionId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/DecisionDefinitionId'
          description: The decision definition ID.
        decisionDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionDefinitionKey'
          description: The key of the decision definition.
        decisionEvaluationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/DecisionEvaluationKey'
          description: The key of the decision evaluation.

    AuditLogSearchQuerySortRequest:
      type: object
      additionalProperties: false
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - timestamp
            - operationType
            - entityType
            - status
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    AuditLogSearchQueryRequest:
      description: Audit log search request.
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogSearchQuerySortRequest'
        filter:
          allOf:
            - $ref: '#/components/schemas/AuditLogFilter'
          description: The audit log search filters.

    AuditLogFilter:
      description: Audit log filter request
      type: object
      properties:
        processDefinitionKey:
          description: The process definition key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKeyFilterProperty'
        processInstanceKey:
          description: The process instance key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessInstanceKeyFilterProperty'
        elementInstanceKey:
          description: The element instance key search filter.
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ElementInstanceKeyFilterProperty'
        operationType:
          description: The operation type search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        operationStatus:
          description: The operation status search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        timestamp:
          description: The timestamp search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/DateTimeFilterProperty'
        actorId:
          description: The actor ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        actorType:
          description: The actor type search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        entityType:
          description: The entity type search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        tenantId:
          description: The tenant ID search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        operationCategory:
          description: The operation category search filter.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'

    AuditLogSearchQueryResult:
      description: Audit log search response.
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching audit logs.
          type: array
          items:
            $ref: '#/components/schemas/AuditLogResult'

    ## Enums

    AuditLogEntityTypeEnum:
      type: string
      enum:
        - PROCESS
        - PROCESS_INSTANCE
        - INCIDENT
        - USER_TASK
        - BATCH
        - VARIABLE

    AuditLogOperationTypeEnum:
      type: string
      enum:
        - CREATE
        - UPDATE
        - MIGRATE
        - DELETE
        - SUSPEND
        - RESUME
        - CANCEL

    AuditLogActorTypeEnum:
      type: string
      enum:
        - USER
        - CLIENT

    AuditLogOperationStatusEnum:
      type: string
      enum:
        - SUCCESS
        - FAIL

    AuditLogCategoryEnum:
      type: string
      enum:
        - OPERATOR
        - USER_TASK
        - ADMIN

    AuditLogBatchOperationTypeEnum:
      type: string
      enum:
        - CANCEL_PROCESS_INSTANCE
        - MIGRATE_PROCESS_INSTANCE
        - MODIFY_PROCESS_INSTANCE
        - RESOLVE_INCIDENT
