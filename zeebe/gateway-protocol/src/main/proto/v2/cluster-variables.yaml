## Endpoint definitions

paths:
  /cluster-variables:
    post:
      tags:
        - Cluster Variable
      summary: Create a new cluster variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClusterVariableRequest'
      responses:
        '200':
          description: Cluster variable created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/search:
    post:
      tags:
        - Cluster Variable
      operationId: searchClusterVariables
      summary: Search cluster variables
      description: Search for cluster variables based on given criteria.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClusterVariableSearchQueryRequest'
      responses:
        "200":
          description: The cluster variable search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableSearchQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true
  /cluster-variables/{name}/GLOBAL:
    delete:
      tags:
        - Cluster Variable
      summary: Delete a global-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '204':
          description: Cluster variable deleted successfully
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    get:
      tags:
        - Cluster Variable
      summary: Get a global-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '200':
          description: Cluster variable found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/{name}/TENANT/{tenantId}:
    delete:
      tags:
        - Cluster Variable
      summary: Delete a tenant-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
          description: The tenant ID
      responses:
        '204':
          description: Cluster variable deleted successfully
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    get:
      tags:
        - Cluster Variable
      summary: Get a tenant-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
          description: The tenant ID
      responses:
        '200':
          description: Cluster variable found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

components:
  schemas:
    ClusterVariableScopeEnum:
      type: string
      enum: [ GLOBAL, TENANT ]
      description: The scope of a cluster variable - either GLOBAL or TENANT
    CreateClusterVariableRequest:
      type: object
      required:
        - name
        - value
        - scope
      properties:
        name:
          type: string
        value:
          type: object
        scope:
          $ref: '#/components/schemas/ClusterVariableScopeEnum'
        tenantId:
          type: string
          nullable: true
          description: Required if scope is TENANT, must be null or undefined for GLOBAL
    ClusterVariableResult:
      type: object
      properties:
        name:
          type: string
        value:
          type: string
        scope:
          $ref: '#/components/schemas/ClusterVariableScopeEnum'
        tenantId:
          type: string
          nullable: true
          description: Required if scope is TENANT, must be null or undefined for GLOBAL
    ClusterVariableSearchQueryRequest:
      description: Cluster variable search query request.
      additionalProperties: false
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/ClusterVariableSearchQuerySortRequest'
        filter:
          description: The cluster variable search filters.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableSearchQueryFilterRequest'
    ClusterVariableSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - name
            - value
            - tenantId
            - scope
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field
    ClusterVariableSearchQueryFilterRequest:
      description: Cluster variable filter request.
      type: object
      properties:
        name:
          description: Name of the cluster variable.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        value:
          description: The value of the cluster variable.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        scope:
          description: The scope filter for cluster variables.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableScopeEnum'
        tenantId:
          description: Tenant ID of this variable.
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/TenantId'
    ClusterVariableSearchQueryResult:
      description: Cluster variable search query response.
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching cluster variables.
          type: array
          items:
            $ref: '#/components/schemas/ClusterVariableResult'
