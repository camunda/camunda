## Endpoint definitions

paths:
  /cluster-variables/global:
    post:
      operationId: createGlobalClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Create a global-scoped cluster variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClusterVariableRequest'
      responses:
        '200':
          description: Cluster variable created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/tenants/{tenantId}:
    post:
      operationId: createTenantClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Create a tenant-scoped cluster variable
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClusterVariableRequest'
      responses:
        '200':
          description: Cluster variable created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/search:
    post:
      tags:
        - Cluster Variable
      operationId: searchClusterVariables
      x-eventually-consistent: true
      description: Search for cluster variables based on given criteria. By default, long variable values in the response are truncated.
      parameters:
        - name: truncateValues
          in: query
          required: false
          description: When true (default), long variable values in the response are truncated. When false, full variable values are returned.
          schema:
            type: boolean
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClusterVariableSearchQueryRequest'
      responses:
        "200":
          description: The cluster variable search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableSearchQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/global/{name}:
    get:
      operationId: getGlobalClusterVariable
      x-eventually-consistent: true
      tags:
        - Cluster Variable
      summary: Get a global-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '200':
          description: Cluster variable found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    patch:
      operationId: updateGlobalClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Update a global-scoped cluster variable
      description: |
        Updates the value of an existing global cluster variable.
        The variable must exist, otherwise a 404 error is returned.
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateClusterVariableRequest'
      responses:
        '200':
          description: Cluster variable updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    delete:
      operationId: deleteGlobalClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Delete a global-scoped cluster variable
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '204':
          description: Cluster variable deleted successfully
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
  /cluster-variables/tenants/{tenantId}/{name}:
    get:
      operationId: getTenantClusterVariable
      x-eventually-consistent: true
      tags:
        - Cluster Variable
      summary: Get a tenant-scoped cluster variable
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '200':
          description: Cluster variable found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    patch:
      operationId: updateTenantClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Update a tenant-scoped cluster variable
      description: |
        Updates the value of an existing tenant-scoped cluster variable.
        The variable must exist, otherwise a 404 error is returned.
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateClusterVariableRequest'
      responses:
        '200':
          description: Cluster variable updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClusterVariableResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
    delete:
      operationId: deleteTenantClusterVariable
      x-eventually-consistent: false
      tags:
        - Cluster Variable
      summary: Delete a tenant-scoped cluster variable
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: The tenant ID
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: The name of the cluster variable
      responses:
        '204':
          description: Cluster variable deleted successfully
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: Cluster variable not found
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

components:
  schemas:
    ClusterVariableScopeEnum:
      type: string
      enum: [ GLOBAL, TENANT ]
      description: The scope of a cluster variable.
    CreateClusterVariableRequest:
      type: object
      required:
        - name
        - value
      properties:
        name:
          type: string
          description: The name of the cluster variable. Must be unique within its scope (global or tenant-specific).
        value:
          type: object
          description: The value of the cluster variable. Can be any JSON object or primitive value. Will be serialized as a JSON string in responses.
    UpdateClusterVariableRequest:
      type: object
      required:
        - value
      properties:
        value:
          type: object
          description: The new value of the cluster variable. Can be any JSON object or primitive value. Will be serialized as a JSON string in responses.
    ClusterVariableResult:
      type: object
      allOf:
        - $ref: '#/components/schemas/ClusterVariableResultBase'
      properties:
        value:
          description: Full value of this cluster variable.
          type: string
    ClusterVariableSearchResult:
      description: Cluster variable search response item.
      type: object
      allOf:
        - $ref: '#/components/schemas/ClusterVariableResultBase'
      properties:
        value:
          description: Value of this cluster variable. Can be truncated.
          type: string
        isTruncated:
          description: Whether the value is truncated or not.
          type: boolean
    ClusterVariableResultBase:
      description: Cluster variable response item.
      type: object
      required:
        - name
        - value
        - scope
      properties:
        name:
          type: string
          description: The name of the cluster variable. Unique within its scope (global or tenant-specific).
        scope:
          $ref: '#/components/schemas/ClusterVariableScopeEnum'
        tenantId:
          type: string
          description: Only provided if the cluster variable scope is TENANT.
    ClusterVariableSearchQueryRequest:
      description: Cluster variable search query request.
      additionalProperties: false
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/ClusterVariableSearchQuerySortRequest'
        filter:
          description: The cluster variable search filters.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableSearchQueryFilterRequest'
    ClusterVariableSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - name
            - value
            - tenantId
            - scope
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field
    ClusterVariableSearchQueryFilterRequest:
      description: Cluster variable filter request.
      type: object
      properties:
        name:
          description: Name of the cluster variable.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        value:
          description: The value of the cluster variable.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        scope:
          description: The scope filter for cluster variables.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableScopeFilterProperty'
        tenantId:
          description: Tenant ID of this variable.
          allOf:
            - $ref: 'filters.yaml#/components/schemas/StringFilterProperty'
        isTruncated:
          description: |
            Filter cluster variables by truncation status of their stored values. When true, returns only variables whose stored values are truncated (i.e., the value exceeds the storage size limit and is truncated in storage). When false, returns only variables with non-truncated stored values. This filter is based on the underlying storage characteristic, not the response format.
          type: boolean
    ClusterVariableScopeFilterProperty:
      description: ClusterVariableScopeEnum property with full advanced search capabilities.
      type: object
      oneOf:
        - type: string
          title: Exact match
          description: Matches the value exactly.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableScopeEnum'
        - $ref: '#/components/schemas/AdvancedClusterVariableScopeFilter'
    AdvancedClusterVariableScopeFilter:
      title: Advanced filter
      description: Advanced ClusterVariableScopeEnum filter.
      type: object
      properties:
        $eq:
          description: Checks for equality with the provided value.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableScopeEnum'
        $neq:
          description: Checks for inequality with the provided value.
          allOf:
            - $ref: '#/components/schemas/ClusterVariableScopeEnum'
        $exists:
          description: Checks if the current property exists.
          type: boolean
        $in:
          description: Checks if the property matches any of the provided values.
          type: array
          items:
            $ref: '#/components/schemas/ClusterVariableScopeEnum'
        $like:
          $ref: "filters.yaml#/components/schemas/LikeFilter"
    ClusterVariableSearchQueryResult:
      description: Cluster variable search query response.
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching cluster variables.
          type: array
          items:
            $ref: '#/components/schemas/ClusterVariableSearchResult'
