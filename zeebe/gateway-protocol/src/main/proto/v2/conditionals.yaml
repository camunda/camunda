## Endpoint definitions

paths:
  /conditionals:
    post:
      x-eventually-consistent: false
      tags:
        - Conditional
      operationId: evaluateConditionalEvent
      summary: Evaluate conditional events
      description: Used to evaluate root level conditional events for process definitions.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConditionalEventEvaluationInstruction'
            examples:
              Evaluate all process definitions:
                summary: Evaluate conditional events across all process definitions
                value:
                  variables:
                    orderAmount: 1000
                    region: "EU"
              Evaluate specific process definition:
                summary: Evaluate conditional events for a specific process definition
                value:
                  processDefinitionKey: "2251799813686749"
                  variables:
                    orderAmount: 1000
              Evaluate with tenant:
                summary: Evaluate conditional events for a specific tenant
                value:
                  tenantId: "tenant-123"
                  variables:
                    orderAmount: 1000
      responses:
        "200":
          description: Successfully evaluated conditional events.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluateConditionalEventResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'

components:
  schemas:
    ConditionalEventEvaluationInstruction:
      type: object
      required:
        - variables
      properties:
        tenantId:
          allOf:
            - $ref: 'identifiers.yaml#/components/schemas/TenantId'
          description: Used to evaluate a conditional event for a tenant with the given ID. This will only evaluate conditionals of process definitions which belong to the tenant.
        processDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKey'
          description: Used to evaluate conditions of the process definition with the given key.
        variables:
          type: object
          description: A JSON serialized document describing variables as key value pairs; the root of the document must be an object. Variables will be used for evaluation of the conditions and are injected into the process instances which have been triggered.
          additionalProperties: true
          example:
            x: 2

    EvaluateConditionalEventResult:
      type: object
      properties:
        processInstances:
          type: array
          items:
            $ref: '#/components/schemas/ProcessInstanceReference'
          description: List of process instances that were triggered.

    ProcessInstanceReference:
      type: object
      properties:
        processDefinitionKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessDefinitionKey'
          description: The key of the process definition.
        processInstanceKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/ProcessInstanceKey'
          description: The key of the created process instance.
