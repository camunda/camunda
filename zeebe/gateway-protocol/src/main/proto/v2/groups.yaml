## Endpoint definitions
paths:
  /groups:
    post:
      tags:
        - Group
      operationId: createGroup
      summary: Create group
      description: Create a new group.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupCreateRequest'
      responses:
        "201":
          description: The group was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupCreateResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /groups/search:
    post:
      tags:
        - Group
      operationId: searchGroups
      summary: Search groups
      description: Search for groups based on given criteria.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupSearchQueryRequest'
      responses:
        "200":
          description: The groups search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupSearchQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          description: An internal error occurred while processing the request.
      x-eventually-consistent: true

  /groups/{groupId}:
    get:
      tags:
        - Group
      operationId: getGroup
      summary: Get group
      description: Get a group by its ID.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      responses:
        "200":
          description: The group is successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupResult'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

    put:
      tags:
        - Group
      operationId: updateGroup
      summary: Update group
      description: Update a group with the given ID.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupUpdateRequest'
      responses:
        "200":
          description: The group was updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupUpdateResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

    delete:
      tags:
        - Group
      operationId: deleteGroup
      summary: Delete group
      description: Deletes the group with the given ID.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      responses:
        "204":
          description: The group was deleted successfully.
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /groups/{groupId}/users/{username}:
    put:
      tags:
        - Group
      operationId: assignUserToGroup
      summary: Assign a user to a group
      description: |
        Assigns a user to a group, making the user a member of the group.
        Group members inherit the group authorizations, roles, and tenant assignments.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: username
          in: path
          required: true
          description: The user username.
          schema:
            $ref: 'identifiers.yaml#/components/schemas/Username'
      responses:
        "204":
          description: The user was assigned successfully to the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group or user with the given ID or username was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "409":
          description: The user with the given ID is already assigned to the group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

    delete:
      tags:
        - Group
      operationId: unassignUserFromGroup
      summary: Unassign a user from a group
      description: |
        Unassigns a user from a group.
        The user is removed as a group member, with associated authorizations, roles, and tenant assignments no longer applied.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: username
          in: path
          required: true
          description: The user username.
          schema:
            $ref: 'identifiers.yaml#/components/schemas/Username'
      responses:
        "204":
          description: The user was unassigned successfully from the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group or user with the given ID was not found, or the user is not assigned to this group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /groups/{groupId}/users/search:
    post:
      tags:
        - Group
      operationId: searchUsersForGroup
      summary: Search group users
      description: Search users assigned to a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupUserSearchQueryRequest'
      responses:
        "200":
          description: The users assigned to the group.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupUserSearchResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

  /groups/{groupId}/clients/{clientId}:
    put:
      tags:
        - Group
      operationId: assignClientToGroup
      summary: Assign a client to a group
      description: |
        Assigns a client to a group, making it a member of the group.
        Members of the group inherit the group authorizations, roles, and tenant assignments.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          description: The client ID.
          schema:
            type: string
      responses:
        "204":
          description: The client was assigned successfully to the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "409":
          description: The client with the given ID is already assigned to the group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

    delete:
      tags:
        - Group
      operationId: unassignClientFromGroup
      summary: Unassign a client from a group
      description: |
        Unassigns a client from a group.
        The client is removed as a group member, with associated authorizations, roles, and tenant assignments no longer applied.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: clientId
          in: path
          required: true
          description: The client ID.
          schema:
            type: string
      responses:
        "204":
          description: The client was unassigned successfully from the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found, or the client is not assigned to this group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /groups/{groupId}/clients/search:
    post:
      tags:
        - Group
      operationId: searchClientsForGroup
      summary: Search group clients
      description: Search clients assigned to a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupClientSearchQueryRequest'
      responses:
        "200":
          description: The clients assigned to the group.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupClientSearchResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

  /groups/{groupId}/mapping-rules/{mappingRuleId}:
    put:
      tags:
        - Group
      operationId: assignMappingRuleToGroup
      summary: Assign a mapping rule to a group
      description: Assigns a mapping rule to a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: mappingRuleId
          in: path
          required: true
          description: The mapping rule ID.
          schema:
            type: string
      responses:
        "204":
          description: The mapping rule was assigned successfully to the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group or mapping rule with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "409":
          description: The mapping rule with the given ID is already assigned to the group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

    delete:
      tags:
        - Group
      operationId: unassignMappingRuleFromGroup
      summary: Unassign a mapping rule from a group
      description: Unassigns a mapping rule from a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
        - name: mappingRuleId
          in: path
          required: true
          description: The mapping rule ID.
          schema:
            type: string
      responses:
        "204":
          description: The mapping rule was unassigned successfully from the group.
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group or mapping rule with the given ID was not found, or the mapping rule is not assigned to this group.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /groups/{groupId}/mapping-rules/search:
    post:
      tags:
        - Group
      operationId: searchMappingRulesForGroup
      summary: Search group mapping rules
      description: Search mapping rules assigned to a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      responses:
        "200":
          description: The mapping rules assigned to the group.
          content:
            application/json:
              schema:
                $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

  /groups/{groupId}/roles/search:
    post:
      tags:
        - Group
      operationId: searchRolesForGroup
      summary: Search group roles
      description: Search roles assigned to a group.
      parameters:
        - name: groupId
          in: path
          required: true
          description: The group ID.
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      responses:
        "200":
          description: The roles assigned to the group.
          content:
            application/json:
              schema:
                $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The group with the given ID was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

## Schema definitions

components:
  schemas:
    GroupCreateRequest:
      type: object
      additionalProperties: false
      properties:
        groupId:
          type: string
          description: The ID of the new group.
        name:
          type: string
          description: The display name of the new group.
        description:
          type: string
          description: The description of the new group.
      required:
        - groupId
        - name

    GroupCreateResult:
      type: object
      properties:
        groupId:
          description: The ID of the created group.
          type: string
        name:
          description: The display name of the created group.
          type: string
        description:
          description: The description of the created group.
          type: string

    GroupUpdateRequest:
      type: object
      properties:
        name:
          type: string
          description: The new name of the group.
        description:
          type: string
          description: The new description of the group.
      required:
        - name
        - description

    GroupUpdateResult:
      type: object
      properties:
        groupId:
          type: string
          description: The unique external group ID.
        name:
          type: string
          description: The name of the group.
        description:
          type: string
          description: The description of the group.

    GroupResult:
      description: Group search response item.
      type: object
      properties:
        name:
          type: string
          description: The group name.
        groupId:
          type: string
          description: The group ID.
        description:
          type: string
          description: The group description.

    GroupSearchQuerySortRequest:
      type: object
      additionalProperties: false
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - name
            - groupId
        order:
          $ref: 'enums.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    GroupSearchQueryRequest:
      description: Group search request.
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/GroupSearchQuerySortRequest'
        filter:
          allOf:
            - $ref: '#/components/schemas/GroupFilter'
          description: The group search filters.

    GroupFilter:
      description: Group filter request
      type: object
      properties:
        groupId:
          description: The group ID search filters.
          allOf:
            - $ref: "filters.yaml#/components/schemas/StringFilterProperty"
        name:
          description: The group name search filters.
          type: string

    GroupSearchQueryResult:
      description: Group search response.
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching groups.
          type: array
          items:
            $ref: '#/components/schemas/GroupResult'

    GroupUserResult:
      type: object
      properties:
        username:
          $ref: 'identifiers.yaml#/components/schemas/Username'

    GroupUserSearchResult:
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching members.
          type: array
          items:
            $ref: '#/components/schemas/GroupUserResult'

    GroupUserSearchQueryRequest:
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/GroupUserSearchQuerySortRequest'

    GroupUserSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - username
        order:
          $ref: 'enums.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    GroupClientResult:
      type: object
      properties:
        clientId:
          description: The ID of the client.
          type: string

    GroupClientSearchResult:
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching client IDs.
          type: array
          items:
            $ref: '#/components/schemas/GroupClientResult'

    GroupClientSearchQueryRequest:
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/GroupClientSearchQuerySortRequest'

    GroupClientSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - clientId
        order:
          $ref: 'enums.yaml#/components/schemas/SortOrderEnum'
      required:
        - field
