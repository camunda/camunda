# Endpoint definitions

paths:
  /topology:
    get:
      x-eventually-consistent: false
      tags:
        - Cluster
      operationId: getTopology
      summary: Get cluster topology
      description: Obtains the current topology of the cluster the gateway is part of.
      responses:
        "200":
          description: Obtains the current topology of the cluster the gateway is part of.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopologyResponse'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "500":
            $ref: 'common-responses.yaml#/components/responses/InternalServerError'

  /status:
    get:
      x-eventually-consistent: false
      tags:
        - Cluster
      operationId: getStatus
      summary: Get cluster status
      description: Checks the health status of the cluster by verifying if there's at least one partition with a healthy leader.
      responses:
        "204":
          description: The cluster is UP and has at least one partition with a healthy leader.
        "503":
          description: The cluster is DOWN and does not have any partition with a healthy leader.

## Schema definitions

components:
  schemas:
    TopologyResponse:
      description: The response of a topology request.
      type: object
      required:
        - brokers
        - clusterSize
        - partitionsCount
        - replicationFactor
        - gatewayVersion
        - lastCompletedChangeId
      properties:
        brokers:
          description: A list of brokers that are part of this cluster.
          type: array
          items:
            $ref: '#/components/schemas/BrokerInfo'
        clusterId:
          description: The cluster Id.
          type: string
          nullable: true
        clusterSize:
          description: The number of brokers in the cluster.
          type: integer
          format: int32
          example: 3
        partitionsCount:
          description: The number of partitions are spread across the cluster.
          type: integer
          format: int32
          example: 3
        replicationFactor:
          description: The configured replication factor for this cluster.
          type: integer
          format: int32
          example: 3
        gatewayVersion:
          description: The version of the Zeebe Gateway.
          type: string
          example: 8.8.0
        lastCompletedChangeId:
          description: ID of the last completed change
          type: string
          example: "-1"

    BrokerInfo:
      description: Provides information on a broker node.
      type: object
      required:
        - nodeId
        - host
        - port
        - partitions
        - version
      properties:
        nodeId:
          description: The unique (within a cluster) node ID for the broker.
          type: integer
          format: int32
          example: 0
        host:
          description: The hostname for reaching the broker.
          type: string
          example: zeebe-0.zeebe-broker-service.b7fd7aa3-b973-4128-8789-74cd2318992c-zeebe.svc.cluster.local
        port:
          description: The port for reaching the broker.
          type: integer
          format: int32
          example: 26501
        partitions:
          description: A list of partitions managed or replicated on this broker.
          type: array
          items:
            $ref: '#/components/schemas/Partition'
        version:
          description: The broker version.
          type: string
          example: 8.8.0

    Partition:
      description: Provides information on a partition within a broker node.
      type: object
      required:
        - partitionId
        - role
        - health
      properties:
        partitionId:
          description: The unique ID of this partition.
          type: integer
          format: int32
          example: 1
        role:
          description: Describes the Raft role of the broker for a given partition.
          type: string
          example: leader
          enum:
            - leader
            - follower
            - inactive
        health:
          description: Describes the current health of the partition.
          type: string
          example: healthy
          enum:
            - healthy
            - unhealthy
            - dead
