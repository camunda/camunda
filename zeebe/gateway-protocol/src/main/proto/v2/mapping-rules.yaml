## Endpoint definitions

paths:
  /mapping-rules:
    post:
      x-eventually-consistent: false
      tags:
        - Mapping rule
      operationId: createMappingRule
      summary: Create mapping rule
      description: |
        Create a new mapping rule
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MappingRuleCreateRequest'
      responses:
        "201":
          description: The mapping rule was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingRuleCreateResult'
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "403":
          description: |
            The request to create a mapping rule was denied.
            More details are provided in the response body.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "404":
          description: The request to create a mapping rule was denied.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
  /mapping-rules/{mappingRuleId}:
    put:
      x-eventually-consistent: false
      tags:
        - Mapping rule
      operationId: updateMappingRule
      summary: Update mapping rule
      description: |
        Update a mapping rule.
      parameters:
        - name: mappingRuleId
          in: path
          required: true
          description: The ID of the mapping rule to update.
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MappingRuleUpdateRequest'
      responses:
        "200":
          description: The mapping rule was updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingRuleUpdateResult'
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "403":
          description: |
            The request to update a mapping rule was denied.
            More details are provided in the response body.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "404":
          description: The request to update a mapping rule was denied.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
        "503":
          $ref: "common-responses.yaml#/components/responses/ServiceUnavailable"
    delete:
      x-eventually-consistent: false
      tags:
        - Mapping rule
      operationId: deleteMappingRule
      summary: Delete a mapping rule
      description: |
        Deletes the mapping rule with the given ID.
      parameters:
        - name: mappingRuleId
          in: path
          required: true
          description: The ID of the mapping rule to delete.
          schema:
            type: string
      responses:
        "204":
          description: The mapping rule was deleted successfully.
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "404":
          description: The mapping rule with the mappingRuleId was not found.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
        "503":
          $ref: "common-responses.yaml#/components/responses/ServiceUnavailable"
    get:
      x-eventually-consistent: true
      tags:
        - Mapping rule
      operationId: getMappingRule
      summary: Get a mapping rule
      description: |
        Gets the mapping rule with the given ID.
      parameters:
        - name: mappingRuleId
          in: path
          required: true
          description: The ID of the mapping rule to get.
          schema:
            type: string
      responses:
        "200":
          description: The mapping rule was returned successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingRuleResult'
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "404":
          description: The mapping rule with the mappingRuleId was not found.
          content:
            application/problem+json:
              schema:
                $ref: "problem-detail.yaml#/components/schemas/ProblemDetail"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"
  /mapping-rules/search:
    post:
      x-eventually-consistent: true
      tags:
        - Mapping rule
      operationId: searchMappingRule
      summary: Search mapping rules
      description: |
        Search for mapping rules based on given criteria.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MappingRuleSearchQueryRequest'
      responses:
        "200":
          description: The mapping rule search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MappingRuleSearchQueryResult'
        "400":
          $ref: "common-responses.yaml#/components/responses/InvalidData"
        "401":
          $ref: "common-responses.yaml#/components/responses/Unauthorized"
        "403":
          $ref: "common-responses.yaml#/components/responses/Forbidden"
        "500":
          $ref: "common-responses.yaml#/components/responses/InternalServerError"

## Schema definitions

components:
  schemas:
    MappingRuleCreateUpdateRequest:
      type: object
      properties:
        claimName:
          type: string
          description: The name of the claim to map.
        claimValue:
          type: string
          description: The value of the claim to map.
        name:
          type: string
          description: The name of the mapping rule.
      required:
        - claimName
        - claimValue
        - name

    MappingRuleCreateRequest:
      type: object
      additionalProperties: false
      allOf:
        - $ref: '#/components/schemas/MappingRuleCreateUpdateRequest'
      properties:
        mappingRuleId:
          type: string
          description: The unique ID of the mapping rule.
      required:
        - mappingRuleId

    MappingRuleUpdateRequest:
      type: object
      allOf:
        - $ref: '#/components/schemas/MappingRuleCreateUpdateRequest'

    MappingRuleCreateUpdateResult:
      type: object
      properties:
        claimName:
          type: string
          description: The name of the claim to map.
        claimValue:
          type: string
          description: The value of the claim to map.
        name:
          type: string
          description: The name of the mapping rule.
        mappingRuleId:
          type: string
          description: The unique ID of the mapping rule.

    MappingRuleCreateResult:
      type: object
      allOf:
        - $ref: '#/components/schemas/MappingRuleCreateUpdateResult'

    MappingRuleUpdateResult:
      type: object
      allOf:
        - $ref: '#/components/schemas/MappingRuleCreateUpdateResult'

    MappingRuleSearchQueryResult:
      type: object
      allOf:
        - $ref: "search-models.yaml#/components/schemas/SearchQueryResponse"
      properties:
        items:
          description: The matching mapping rules.
          type: array
          items:
            $ref: '#/components/schemas/MappingRuleResult'

    MappingRuleResult:
      type: object
      properties:
        claimName:
          type: string
          description: The name of the claim to map.
        claimValue:
          type: string
          description: The value of the claim to map.
        name:
          type: string
          description: The name of the mapping rule.
        mappingRuleId:
          type: string
          description: The ID of the mapping rule.

    MappingRuleSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - mappingRuleId
            - claimName
            - claimValue
            - name
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    MappingRuleSearchQueryRequest:
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      type: object
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/MappingRuleSearchQuerySortRequest'
        filter:
          description: The mapping rule search filters.
          allOf:
            - $ref: '#/components/schemas/MappingRuleFilter'

    MappingRuleFilter:
      description: Mapping rule search filter.
      type: object
      properties:
        claimName:
          type: string
          description: The claim name to match against a token.
        claimValue:
          type: string
          description: The value of the claim to match.
        name:
          type: string
          description: The name of the mapping rule.
        mappingRuleId:
          type: string
          description: The ID of the mapping rule.
