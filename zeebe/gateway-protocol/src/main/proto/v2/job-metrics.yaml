## Endpoint definitions

paths:
  /jobs/statistics/global:
    get:
      x-eventually-consistent: true
      tags:
        - Job
      operationId: getGlobalJobStatistics
      summary: Global job statistics
      description: |
        Returns global aggregated counts for jobs. Optionally filter by the creation time window and/or jobType.
      parameters:
        - name: from
          in: query
          required: true
          description: |
            Start of the time window to filter metrics. ISO 8601 date-time format.
          schema:
            type: string
            format: date-time
          example: "2024-07-28T15:51:28.071Z"
        - name: to
          in: query
          required: true
          description: |
            End of the time window to filter metrics. ISO 8601 date-time format.
          schema:
            type: string
            format: date-time
          example: "2024-07-29T15:51:28.071Z"
        - name: jobType
          in: query
          required: false
          description: Optional job type to limit the aggregation to a single job type.
          schema:
            type: string
          example: "fetch-customer-data"
      responses:
        "200":
          description: Global job metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GlobalJobStatisticsQueryResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

## Schema definitions

components:
  schemas:

    GlobalJobStatisticsQueryResult:
      description: Global job statistics query result.
      type: object
      required:
        - created
        - completed
        - failed
        - isIncomplete
      properties:
        created:
          $ref: '#/components/schemas/StatusMetric'
        completed:
          $ref: '#/components/schemas/StatusMetric'
        failed:
          $ref: '#/components/schemas/StatusMetric'
        isIncomplete:
          description: True if some data is missing because internal limits were reached and some metrics were not recorded.
          type: boolean
          example: false

    StatusMetric:
      description: Metric for a single job status.
      type: object
      required:
        - count
        - lastUpdatedAt
      properties:
        count:
          description: Number of jobs in this status.
          type: integer
          format: int64
          example: 145
        lastUpdatedAt:
          description: ISO 8601 timestamp of the last update for this status.
          type: string
          format: date-time
          example: "2024-07-29T15:51:28.071Z"

