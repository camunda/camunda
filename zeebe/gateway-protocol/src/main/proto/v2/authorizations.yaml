## Endpoint definitions
paths:
  /authorizations:
    post:
      tags:
        - Authorization
      operationId: createAuthorization
      summary: Create authorization
      description: Create the authorization.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationCreateResult'
        required: true
      responses:
        "201":
          description: The authorization was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The owner was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /authorizations/{authorizationKey}:
    put:
      tags:
        - Authorization
      operationId: updateAuthorization
      summary: Update authorization
      description: Update the authorization with the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to delete.
          schema:
            $ref: 'keys.yaml#/components/schemas/AuthorizationKey'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationRequest'
        required: true
      responses:
        "204":
          description: The authorization was updated successfully.
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The authorization with the authorizationKey was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

    get:
      tags:
        - Authorization
      operationId: getAuthorization
      summary: Get authorization
      description: Get authorization by the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to get.
          schema:
            $ref: 'keys.yaml#/components/schemas/AuthorizationKey'
      responses:
        "200":
          description: The authorization was successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationResult'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The authorization with the given key was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

    delete:
      tags:
        - Authorization
      operationId: deleteAuthorization
      summary: Delete authorization
      description: Deletes the authorization with the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to delete.
          schema:
            $ref: 'keys.yaml#/components/schemas/AuthorizationKey'
      responses:
        "204":
          description: The authorization was deleted successfully.
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The authorization with the authorizationKey was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'
      x-eventually-consistent: false

  /authorizations/search:
    post:
      tags:
        - Authorization
      summary: Search authorizations
      description: Search for authorizations based on given criteria.
      operationId: searchAuthorizations
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationSearchQuery'
      responses:
        "200":
          description: The authorization search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationSearchResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
      x-eventually-consistent: true

## Schema definitions

components:
  schemas:
    AuthorizationRequest:
      type: object
      additionalProperties: false
      properties:
        ownerId:
          description: The ID of the owner of the permissions.
          type: string
        ownerType:
          $ref: 'enums.yaml#/components/schemas/OwnerTypeEnum'
        resourceId:
          description: The ID of the resource to add permissions to.
          type: string
        resourceType:
          $ref: 'enums.yaml#/components/schemas/ResourceTypeEnum'
        permissionTypes:
          type: array
          items:
            $ref: 'enums.yaml#/components/schemas/PermissionTypeEnum'
      required:
        - ownerId
        - ownerType
        - resourceId
        - resourceType
        - permissionTypes

    AuthorizationSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - ownerId
            - ownerType
            - resourceId
            - resourceType
        order:
          $ref: 'enums.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    AuthorizationSearchQuery:
      type: object
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/AuthorizationSearchQuerySortRequest'
        filter:
          allOf:
            - $ref: '#/components/schemas/AuthorizationFilter'
          description: The authorization search filters.

    AuthorizationFilter:
      description: Authorization search filter.
      type: object
      properties:
        ownerId:
          description: The ID of the owner of permissions.
          type: string
        ownerType:
          $ref: 'enums.yaml#/components/schemas/OwnerTypeEnum'
        resourceIds:
          description: The IDs of the resource to search permissions for.
          type: array
          items:
            type: string
        resourceType:
          $ref: 'enums.yaml#/components/schemas/ResourceTypeEnum'

    AuthorizationResult:
      type: object
      properties:
        ownerId:
          description: The ID of the owner of permissions.
          type: string
        ownerType:
          $ref: 'enums.yaml#/components/schemas/OwnerTypeEnum'
        resourceType:
          $ref: 'enums.yaml#/components/schemas/ResourceTypeEnum'
        resourceId:
          description: ID of the resource the permission relates to.
          type: string
        permissionTypes:
          description: Specifies the types of the permissions.
          type: array
          items:
            $ref: 'enums.yaml#/components/schemas/PermissionTypeEnum'
        authorizationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/AuthorizationKey'
          description: The key of the authorization.

    AuthorizationSearchResult:
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching authorizations.
          type: array
          items:
            $ref: '#/components/schemas/AuthorizationResult'

    AuthorizationCreateResult:
      type: object
      properties:
        authorizationKey:
          allOf:
            - $ref: 'keys.yaml#/components/schemas/AuthorizationKey'
          description: The key of the created authorization.
