## Endpoint definitions
paths:
  /authorizations:
    post:
      x-eventually-consistent: false
      tags:
        - Authorization
      operationId: createAuthorization
      summary: Create authorization
      description: Create the authorization.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationRequest'
        required: true
      responses:
        "201":
          description: The authorization was created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationCreateResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The owner was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'

  /authorizations/{authorizationKey}:
    put:
      x-eventually-consistent: false
      tags:
        - Authorization
      operationId: updateAuthorization
      summary: Update authorization
      description: Update the authorization with the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to delete.
          schema:
            $ref: '#/components/schemas/AuthorizationKey'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationRequest'
        required: true
      responses:
        "204":
          description: The authorization was updated successfully.
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The authorization with the authorizationKey was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'

    get:
      x-eventually-consistent: true
      tags:
        - Authorization
      operationId: getAuthorization
      summary: Get authorization
      description: Get authorization by the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to get.
          schema:
            $ref: '#/components/schemas/AuthorizationKey'
      responses:
        "200":
          description: The authorization was successfully returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationResult'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "404":
          description: The authorization with the given key was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

    delete:
      x-eventually-consistent: false
      tags:
        - Authorization
      operationId: deleteAuthorization
      summary: Delete authorization
      description: Deletes the authorization with the given key.
      parameters:
        - name: authorizationKey
          in: path
          required: true
          description: The key of the authorization to delete.
          schema:
            $ref: '#/components/schemas/AuthorizationKey'
      responses:
        "204":
          description: The authorization was deleted successfully.
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "404":
          description: The authorization with the authorizationKey was not found.
          content:
            application/problem+json:
              schema:
                $ref: 'problem-detail.yaml#/components/schemas/ProblemDetail'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'
        "503":
          $ref: 'common-responses.yaml#/components/responses/ServiceUnavailable'

  /authorizations/search:
    post:
      x-eventually-consistent: true
      tags:
        - Authorization
      summary: Search authorizations
      description: Search for authorizations based on given criteria.
      operationId: searchAuthorizations
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationSearchQuery'
      responses:
        "200":
          description: The authorization search result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationSearchResult'
        "400":
          $ref: 'common-responses.yaml#/components/responses/InvalidData'
        "401":
          $ref: 'common-responses.yaml#/components/responses/Unauthorized'
        "403":
          $ref: 'common-responses.yaml#/components/responses/Forbidden'
        "500":
          $ref: 'common-responses.yaml#/components/responses/InternalServerError'

## Schema definitions

components:
  schemas:
    AuthorizationIdBasedRequest:
      type: object
      additionalProperties: false
      properties:
        ownerId:
          description: The ID of the owner of the permissions.
          type: string
        ownerType:
          $ref: '#/components/schemas/OwnerTypeEnum'
        resourceId:
          description: The ID of the resource to add permissions to.
          type: string
        resourceType:
          description: The type of resource to add permissions to.
          type: string
          allOf:
            - $ref: '#/components/schemas/ResourceTypeEnum'
        permissionTypes:
          type: array
          description: The permission types to add.
          items:
            allOf:
              - $ref: '#/components/schemas/PermissionTypeEnum'
      required:
        - ownerId
        - ownerType
        - resourceId
        - resourceType
        - permissionTypes

    AuthorizationPropertyBasedRequest:
      type: object
      additionalProperties: false
      properties:
        ownerId:
          description: The ID of the owner of the permissions.
          type: string
        ownerType:
          $ref: '#/components/schemas/OwnerTypeEnum'
        resourcePropertyName:
          description: The name of the resource property on which this authorization is based.
          type: string
        resourceType:
          description: The type of resource to add permissions to.
          type: string
          allOf:
            - $ref: '#/components/schemas/ResourceTypeEnum'
        permissionTypes:
          type: array
          description: The permission types to add.
          items:
            allOf:
              - $ref: '#/components/schemas/PermissionTypeEnum'
      required:
        - ownerId
        - ownerType
        - resourcePropertyName
        - resourceType
        - permissionTypes

    AuthorizationRequest:
      x-polymorphic-schema: true
      type: object
      oneOf:
        - $ref: '#/components/schemas/AuthorizationIdBasedRequest'
        - $ref: '#/components/schemas/AuthorizationPropertyBasedRequest'
      description: |
        Defines an authorization request.
        Either an id-based or a property-based authorization can be provided.

    AuthorizationSearchQuerySortRequest:
      type: object
      properties:
        field:
          description: The field to sort by.
          type: string
          enum:
            - ownerId
            - ownerType
            - resourceId
            - resourcePropertyName
            - resourceType
        order:
          $ref: 'search-models.yaml#/components/schemas/SortOrderEnum'
      required:
        - field

    AuthorizationSearchQuery:
      type: object
      additionalProperties: false
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryRequest'
      properties:
        sort:
          description: Sort field criteria.
          type: array
          items:
            $ref: '#/components/schemas/AuthorizationSearchQuerySortRequest'
        filter:
          allOf:
            - $ref: '#/components/schemas/AuthorizationFilter'
          description: The authorization search filters.

    AuthorizationFilter:
      description: Authorization search filter.
      type: object
      properties:
        ownerId:
          description: The ID of the owner of permissions.
          type: string
        ownerType:
          $ref: '#/components/schemas/OwnerTypeEnum'
        resourceIds:
          description: The IDs of the resource to search permissions for.
          type: array
          items:
            type: string
        resourcePropertyNames:
          description: The names of the resource properties to search permissions for.
          type: array
          items:
            type: string
        resourceType:
          description: The type of resource to search permissions for.
          type: string
          allOf:
            - $ref: '#/components/schemas/ResourceTypeEnum'

    AuthorizationResult:
      type: object
      properties:
        ownerId:
          description: The ID of the owner of permissions.
          type: string
        ownerType:
          $ref: '#/components/schemas/OwnerTypeEnum'
        resourceType:
          description: The type of resource that the permissions relate to.
          type: string
          allOf:
            - $ref: '#/components/schemas/ResourceTypeEnum'
        resourceId:
          description: ID of the resource the permission relates to (mutually exclusive with `resourcePropertyName`).
          type: string
        resourcePropertyName:
          description: The name of the resource property the permission relates to (mutually exclusive with `resourceId`).
          type: string
        permissionTypes:
          description: Specifies the types of the permissions.
          type: array
          items:
            $ref: '#/components/schemas/PermissionTypeEnum'
        authorizationKey:
          allOf:
            - $ref: '#/components/schemas/AuthorizationKey'
          description: The key of the authorization.

    AuthorizationSearchResult:
      type: object
      allOf:
        - $ref: 'search-models.yaml#/components/schemas/SearchQueryResponse'
      properties:
        items:
          description: The matching authorizations.
          type: array
          items:
            $ref: '#/components/schemas/AuthorizationResult'

    AuthorizationCreateResult:
      type: object
      properties:
        authorizationKey:
          allOf:
            - $ref: '#/components/schemas/AuthorizationKey'
          description: The key of the created authorization.

    ## Enums

    PermissionTypeEnum:
      description: Specifies the type of permissions.
      type: string
      enum:
        - ACCESS
        - CANCEL_PROCESS_INSTANCE
        - CLAIM
        - COMPLETE
        - CREATE
        - CREATE_BATCH_OPERATION_CANCEL_PROCESS_INSTANCE
        - CREATE_BATCH_OPERATION_DELETE_DECISION_DEFINITION
        - CREATE_BATCH_OPERATION_DELETE_DECISION_INSTANCE
        - CREATE_BATCH_OPERATION_DELETE_PROCESS_DEFINITION
        - CREATE_BATCH_OPERATION_DELETE_PROCESS_INSTANCE
        - CREATE_BATCH_OPERATION_MIGRATE_PROCESS_INSTANCE
        - CREATE_BATCH_OPERATION_MODIFY_PROCESS_INSTANCE
        - CREATE_BATCH_OPERATION_RESOLVE_INCIDENT
        - CREATE_DECISION_INSTANCE
        - CREATE_PROCESS_INSTANCE
        - DELETE
        - DELETE_DECISION_INSTANCE
        - DELETE_DRD
        - DELETE_FORM
        - DELETE_PROCESS
        - DELETE_PROCESS_INSTANCE
        - DELETE_RESOURCE
        - EVALUATE
        - MODIFY_PROCESS_INSTANCE
        - READ
        - READ_DECISION_DEFINITION
        - READ_DECISION_INSTANCE
        - READ_JOB_METRIC
        - READ_PROCESS_DEFINITION
        - READ_PROCESS_INSTANCE
        - READ_USAGE_METRIC
        - READ_USER_TASK
        - UPDATE
        - UPDATE_PROCESS_INSTANCE
        - UPDATE_USER_TASK

    ResourceTypeEnum:
      description: The type of resource to add/remove permissions to/from.
      type: string
      enum:
        - AUDIT_LOG
        - AUTHORIZATION
        - BATCH
        - CLUSTER_VARIABLE
        - COMPONENT
        - DECISION_DEFINITION
        - DECISION_REQUIREMENTS_DEFINITION
        - DOCUMENT
        - EXPRESSION
        - GROUP
        - MAPPING_RULE
        - MESSAGE
        - PROCESS_DEFINITION
        - RESOURCE
        - ROLE
        - SYSTEM
        - TENANT
        - USER
        - USER_TASK

    OwnerTypeEnum:
      type: string
      description: The type of the owner of permissions.
      enum:
        - USER
        - CLIENT
        - ROLE
        - GROUP
        - MAPPING_RULE
        - UNSPECIFIED

    ## Keys

    AuthorizationKey:
      allOf:
        - $ref: 'keys.yaml#/components/schemas/LongKey'
      description: System-generated key for an authorization.
      format: AuthorizationKey
      x-semantic-type: AuthorizationKey
      example: "2251799813684332"
      type: string
